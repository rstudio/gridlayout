{"version":3,"sources":["utils-misc.ts","utils-grid.ts","make-elements.ts","make-focused_modal.ts","utils-cssom.ts","utils-icons.ts","make-toggle_switch.ts","wrap_in_grided.ts","utils-shiny.ts","make-css_unit_input.ts","make-incrementer.ts","App_State.ts","index.ts","../../../../../.config/yarn/global/node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["OVERLAY_ID","OldModule","module","bundle","Module","moduleName","call","hot","data","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","push","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","WebSocket","hostname","location","protocol","ws","onmessage","event","JSON","parse","type","handled","assets","forEach","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","id","every","generated","js","console","clear","hmrApply","v","hmrAcceptRun","reload","close","onclose","log","removeErrorOverlay","error","message","stack","overlay","createErrorOverlay","document","body","appendChild","getElementById","remove","createElement","stackTrace","innerText","innerHTML","getParents","modules","parents","k","d","dep","Array","isArray","length","concat","Function","deps","cached","cache","some","cb"],"mappings":"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","file":"index.js","sourceRoot":"..","sourcesContent":["export type XY_Pos = {\n  x: number;\n  y: number;\n};\n\nexport type Drag_Type = \"top-left\" | \"bottom-right\" | \"center\";\n\nexport type Selection_Rect = {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n};\n\n\nexport function concat(\n  string_vec: Array<string>,\n  collapse_char: string = \" \"\n): string {\n  return string_vec.reduce(\n    (concatted, current, i) =>\n      concatted + (i > 0 ? collapse_char : \"\") + current,\n    \"\"\n  );\n}\n\nexport function concat_nl(...component_strings: string[]) {\n  return concat(component_strings, \"\\n\");\n}\n\nexport function concat_sp(...component_strings: string[]) {\n  return concat(component_strings, \" \");\n}\n\nexport function as_array<T>(content: T | Array<T>): Array<T> {\n  if (content instanceof Array) {\n    return content;\n  } else {\n    return [content];\n  }\n}\n\n// Passing an undefined value to a compare like min or max will always give undefined\n// These functions let you default to the second option in the case the first is falsy\nexport function compare_w_missing(\n  compare_fn: (...values: number[]) => number,\n  maybe_a: number | null,\n  b: number\n) {\n  return maybe_a ? compare_fn(maybe_a, b) : b;\n}\n\nexport function min_w_missing(maybe_a: number | null, b: number) {\n  return compare_w_missing(Math.min, maybe_a, b);\n}\n\nexport function max_w_missing(maybe_a: number | null, b: number) {\n  return compare_w_missing(Math.max, maybe_a, b);\n}\n\n// Produce bounding rectangle relative to parent of any element\nexport function get_bounding_rect(el: HTMLElement): Selection_Rect | null {\n  if (el.offsetParent === null) {\n    return null;\n  }\n  const top = el.offsetTop;\n  const left = el.offsetLeft;\n  const height = el.offsetHeight;\n  const width = el.offsetWidth;\n  return { left: left, right: left + width, top: top, bottom: top + height };\n}\n\nexport function boxes_overlap(\n  box_a: Selection_Rect,\n  box_b: Selection_Rect\n): boolean {\n  const horizontal_overlap = intervals_overlap(\n    [box_a.left, box_a.right],\n    [box_b.left, box_b.right]\n  );\n  const vertical_overlap = intervals_overlap(\n    [box_a.top, box_a.bottom],\n    [box_b.top, box_b.bottom]\n  );\n\n  return horizontal_overlap && vertical_overlap;\n\n  // Figure out of two intervals overlap eachother\n  function intervals_overlap([a_start, a_end], [b_start, b_end]) {\n    //   aaaaaaaaaa\n    // bbbbbb\n    //         bbbbbb\n    const a_contains_b_endpoint =\n      (a_start >= b_start && a_start <= b_end) ||\n      (a_end >= b_start && a_end <= b_end);\n\n    //   aaaaaa\n    // bbbbbbbbbb\n    const b_covers_a = a_start <= b_start && a_end >= b_end;\n\n    return a_contains_b_endpoint || b_covers_a;\n  }\n}\n\nexport function update_rect_with_delta(\n  rect: Selection_Rect,\n  delta: XY_Pos,\n  dir: Drag_Type\n): Selection_Rect {\n  // Need to destructure down to numbers to avoid copy\n  const new_rect: Selection_Rect = { ...rect };\n\n  // The bounding here means that we dont let the user drag the box \"inside-out\"\n  if (dir === \"top-left\") {\n    new_rect.left = new_rect.left + delta.x;\n    new_rect.top = new_rect.top + delta.y;\n  } else if (dir === \"bottom-right\") {\n    (new_rect.right = new_rect.right + delta.x), new_rect.left;\n    (new_rect.bottom = new_rect.bottom + delta.y), new_rect.top;\n  } else {\n    // Just move the box\n    new_rect.left += delta.x;\n    new_rect.top += delta.y;\n    new_rect.right += delta.x;\n    new_rect.bottom += delta.y;\n  }\n\n  // Make sure positions are proper for bounding box (in case box was flipped inside out)\n  if (new_rect.left > new_rect.right) {\n    const { left, right } = new_rect;\n    new_rect.right = left;\n    new_rect.left = right;\n  }\n  if (new_rect.top > new_rect.bottom) {\n    const { top, bottom } = new_rect;\n    new_rect.bottom = top;\n    new_rect.top = bottom;\n  }\n\n  return new_rect;\n}\n\nexport function flatten<Type>(arr: Type[][]): Type[] {\n  return [].concat(...arr);\n}\n\nexport function set_class(elements: NodeListOf<HTMLElement>, class_name: string) {\n  \n  elements.forEach(el => {\n    el.classList.add(class_name);\n  });\n  \n}\n\nexport const filler_text = `\n<div class = \"filler_text\">\n  Lorem Ipsum is simply dummy text of the printing and typesetting industry. \n  Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, \n  when an unknown printer took a galley of type and scrambled it to make a type \n  specimen book.\n</div>`;\n","// Functions related to grid construction, editings, etc\n\n\nimport { Code_Text } from \"./make-focused_modal\";\nimport { Element_Info} from \"./index\";\nimport { boxes_overlap, concat, concat_nl, get_bounding_rect, max_w_missing, min_w_missing, Selection_Rect } from \"./utils-misc\";\nimport { App_State, Grid_Pos } from \"./App_State\";\n\n\nfunction get_styles(container: HTMLElement|CSSStyleDeclaration){\n  if (container instanceof HTMLElement){\n    return container.style;\n  } else {\n    return container;\n  }\n}\n\nexport function get_rows(grid_container: HTMLElement|CSSStyleDeclaration) {\n  return get_styles(grid_container).gridTemplateRows.split(\" \");\n}\n\nexport function get_cols(grid_container: HTMLElement|CSSStyleDeclaration) {\n  return get_styles(grid_container).gridTemplateColumns.split(\" \");\n}\n\n// Builds the start/end css string for a grid-{row,column}\nexport function make_template_start_end(start: number, end?: number): string {\n  // If we only have a single value just assume we take up one row\n  // If single index is a negative one, we need to subtract instead of add to it\n  const negative_index: boolean = start < 0;\n\n  // Grid works with lines so if we want an element to end at the 4th column we\n  // need to tell it to end at the (4+1)5th line, so we add one\n  end = end ? end + 1 : start + (negative_index ? -1 : 1);\n  // end = end ? +end + 1 : start + (negative_index ? -1 : 1);\n  return `${start} / ${end}`;\n}\n\n// grid-template-{column,row}: ...\n// Take a vector of css sizes and turn into the format for the css argument for\nexport function sizes_to_template_def(defs: Array<string>) {\n  return concat(defs, \" \");\n}\n\nexport function set_element_in_grid(\n  el: HTMLElement,\n  grid_bounds: Grid_Pos,\n  el_styles?: CSSStyleDeclaration\n) {\n  if (grid_bounds.start_row) {\n    el.style.gridRowStart = grid_bounds.start_row.toString();\n  }\n  if (grid_bounds.end_row) {\n    el.style.gridRowEnd = (grid_bounds.end_row + 1).toString();\n  }\n  if (grid_bounds.start_col) {\n    el.style.gridColumnStart = grid_bounds.start_col.toString();\n  }\n  if (grid_bounds.end_col) {\n    el.style.gridColumnEnd = (grid_bounds.end_col + 1).toString();\n  }\n\n  el.style.display = \"block\"; // make sure we can see the element\n}\n\n\nexport function get_pos_on_grid(grid_el: HTMLElement): Grid_Pos {\n  const el_styles = getComputedStyle(grid_el);\n  return {\n    start_row: +el_styles.gridRowStart,\n    start_col: +el_styles.gridColumnStart,\n    end_row: +el_styles.gridRowEnd - 1,\n    end_col: +el_styles.gridColumnEnd - 1,\n  };\n}\n\nexport function get_drag_extent_on_grid(app_state: App_State, selection_rect: Selection_Rect): Grid_Pos {\n  // Reset bounding box definitions so we only use current selection extent\n  const sel_bounds: Grid_Pos = { start_col: null, start_row: null };\n\n  app_state.current_cells.forEach(function (el) {\n    // Cell is overlapped by selection box\n    if (boxes_overlap(get_bounding_rect(el), selection_rect)) {\n      const el_row: number = +el.dataset.row;\n      const el_col: number = +el.dataset.col;\n      sel_bounds.start_row = min_w_missing(sel_bounds.start_row, el_row);\n      sel_bounds.end_row = max_w_missing(sel_bounds.end_row, el_row);\n      sel_bounds.start_col = min_w_missing(sel_bounds.start_col, el_col);\n      sel_bounds.end_col = max_w_missing(sel_bounds.end_col, el_col);\n    }\n  });\n\n  return sel_bounds;\n}\n\nexport function bounding_rect_to_css_pos(rect: Selection_Rect) {\n  return {\n    left: `${rect.left}px`,\n    top: `${rect.top}px`,\n    width: `${rect.right - rect.left}px`,\n    height: `${rect.bottom - rect.top}px`,\n  };\n}\n\n\n\nexport function gen_code_for_layout(\n  elements: Element_Info[],\n  grid_styles: CSSStyleDeclaration\n): Array<Code_Text> {\n  const container_selector = \"#container\";\n\n  const element_defs = elements.map((el) =>\n    concat_nl(\n      `#${el.id} {`,\n      `  grid-column: ${make_template_start_end(el.start_col, el.end_col)};`,\n      `  grid-row: ${make_template_start_end(el.start_row, el.end_row)};`,\n      `}`\n    )\n  );\n\n  const css_code = concat_nl(\n    `${container_selector} {`,\n    `  display: grid;`,\n    `  grid-template-columns: ${grid_styles.gridTemplateColumns};`,\n    `  grid-template-rows: ${grid_styles.gridTemplateRows};`,\n    `  gap: ${get_gap_size(grid_styles)}`,\n    `}`,\n    ...element_defs\n  );\n\n  const html_code = concat_nl(\n    `<div id = ${container_selector}>`,\n    ...elements.map((el) => concat_nl(`  <div id = \"#${el.id}\">`, `  </div>`)),\n    `</div>`\n  );\n\n  return [\n    { type: \"css\", code: css_code },\n    { type: \"html\", code: html_code },\n  ];\n}\n\nexport function get_gap_size(style: CSSStyleDeclaration|string) {\n  // Older browsers give back both row-gap and column-gap in same query\n  // so we need to reduce to a single value before returning\n\n  const gap_size_vec = (typeof style === \"string\"\n    ? style\n    : style.gap\n  ).split(\" \");\n\n  return gap_size_vec[0];\n}\n\nexport function set_gap_size(\n  container_styles: CSSStyleDeclaration,\n  new_val: string\n) {\n  container_styles.gap = new_val;\n  return new_val;\n}\n","import { Grid_Pos } from \"./App_State\";\nimport { set_element_in_grid } from \"./utils-grid\";\nimport {\n  as_array,\n} from \"./utils-misc\";\n\nexport type Event_Listener = {\n  event: string;\n  func: (event: Event) => void;\n}\n\ntype Element_Contents = {\n  sel_txt: string;\n  text?: string;\n  children?: HTMLElement[];\n};\n\nexport type Element_Opts = {\n  event_listener?: Event_Listener | Event_Listener[];\n  styles?: object;\n  innerHTML?: string;\n  data_props?: object;\n  grid_pos?: Grid_Pos;\n  props?: object;\n}\n\n// Safari doesn't support lookbehinds for regex so we have to make it manually\nfunction extract_id(sel_txt: string): string|null {\n  const id_match: RegExpMatchArray = sel_txt.match(/#([^\\.]+)/g);\n  return id_match ? id_match[0].replace(\"#\", \"\"): null;\n}\n\nfunction extract_classes(sel_txt:string): Array<string>|null {\n  const class_list: RegExpMatchArray = sel_txt.match(/\\.([^\\.#]+)/g);\n  return class_list \n    ? [...class_list].map(c => c.replace(\"\\.\", \"\"))\n    : null;\n}\n\nexport function parse_selector_text(sel_txt: string){\n  return {\n    tag_type: sel_txt.match(/^([^#\\.]+)+/g)[0],\n    el_id: extract_id(sel_txt),\n    class_list: extract_classes(sel_txt),\n  }\n}\n\n// This is a heavy-lifter that takes care of building elements and placing them\n// on the grid etc.. It only create's an element if it needs to, which means\n// that we dont get dom leaks caused by recalling stuff over and over again.\nexport function make_el(\n  parent: HTMLElement,\n  sel_txt: string,\n  opts: Element_Opts = {}\n  ) {  \n\n  let el: HTMLElement = parent.querySelector(sel_txt);\n  if (!el) {\n    // Element doesn't exists so we need to make it\n    el = El({sel_txt});\n\n    if (opts.props) {\n      Object.assign(el, opts.props);\n    }\n\n    parent.appendChild(el);\n  }\n\n  if (opts.event_listener) {\n    as_array(opts.event_listener).forEach(\n      (listener) => (el[\"on\" + listener.event] = listener.func)\n    );\n  }\n\n  if (opts.styles) {\n    Object.assign(el.style, opts.styles);\n  }\n\n  if (opts.innerHTML) {\n    el.innerHTML = opts.innerHTML;\n  }\n\n  if (opts.data_props) {\n    Object.assign(el.dataset, opts.data_props);\n  }\n\n  if (opts.grid_pos) {\n    set_element_in_grid(el, opts.grid_pos);\n  }\n\n  return el;\n}\n\n// Given a list of elements from a query selector, remove them all\nexport function remove_elements(els_to_remove: NodeListOf<Element> | Element[]): void {\n  els_to_remove.forEach((e) => e.remove());\n}\n\nexport function Shadow_El(sel_txt: string, ...children: HTMLElement[]) {\n  const shadow_holder = Block_El(sel_txt);\n  shadow_holder.attachShadow({ mode: \"open\" });\n  const style_sheet = document.createElement(\"style\");\n\n  shadow_holder.shadowRoot.appendChild(style_sheet);\n  children.forEach((child_el) => shadow_holder.shadowRoot.appendChild(child_el))\n  return {\n    el: shadow_holder,\n    style_sheet,\n  };\n}\n\nfunction El(opts: Element_Contents): HTMLElement {\n  const { tag_type, el_id, class_list } = parse_selector_text(opts.sel_txt);\n\n  const el: HTMLElement = document.createElement(tag_type);\n  if (el_id) el.id = el_id;\n  if (class_list) {\n    class_list.forEach((x) => el.classList.add(x));\n  }\n\n  if (opts.text) {\n    el.innerHTML = opts.text;\n  }\n\n  if (opts.children) {\n    opts.children.forEach((child_el) => el.appendChild(child_el));\n  }\n\n  return el;\n}\n\nexport function Block_El(sel_txt: string, ...children: HTMLElement[]) {\n  return El({\n    sel_txt,\n    children,\n  });\n}\n\nexport function Text_El(sel_txt: string, text: string) {\n  return El({\n    sel_txt,\n    text,\n  });\n}\n","import { make_el, Event_Listener } from \"./make-elements\";\nimport { as_array, concat_nl } from \"./utils-misc\";\n\ntype Modal_Options = {\n  background_callbacks?: Event_Listener | Event_Listener[];\n  modal_callbacks?: Event_Listener | Event_Listener[];\n  header_text?: string;\n};\nexport function focused_modal(opts: Modal_Options) {\n  const background = make_el(\n    document.querySelector(\"#grided__holder\"),\n    \"div.background-blurrer\",\n    {\n      event_listener: opts.background_callbacks,\n    }\n  );\n\n  const modal = make_el(background, \"div.focused_modal\", {\n    event_listener: opts.modal_callbacks,\n  });\n\n  if (opts.header_text) {\n    make_el(modal, \"div.focused_modal_header\", {\n      innerHTML: opts.header_text,\n      styles: {\n        paddingBottom: \"1rem\",\n      },\n    });\n  }\n\n  return {\n    background,\n    modal,\n    remove: () => background.remove(),\n  };\n}\n\nexport type Code_Text = {\n  type: string;\n  code: string;\n};\n\nexport function show_code(\n  message: string,\n  code_blocks: Code_Text | Array<Code_Text>\n) {\n  const code_modal = focused_modal({\n    header_text: `${message}`,\n    modal_callbacks: {\n      event: \"click\",\n      func: function (event) {\n        // This is needed to stop clicks on modal from triggering the cancel\n        // event that is attached to the background\n        event.stopPropagation();\n      },\n    },\n    background_callbacks: {\n      event: \"click\",\n      func: close_modal,\n    },\n  });\n\n  as_array(code_blocks).forEach(function (code_to_show) {\n    const num_of_lines: number = code_to_show.code.match(/\\n/g).length;\n\n    const code_section = make_el(\n      code_modal.modal,\n      `div#${code_to_show.type}.code_chunk`,\n      {\n        styles: {\n          display: \"grid\",\n          gridTemplateColumns: \"repeat(2, 1fr)\",\n          gridTemplateRows: \"1fr, auto\",\n          gap: \"4px\",\n          gridTemplateAreas: concat_nl(\n            `\"code_type copy_btn\"`,\n            `\"code_text code_text\"`\n          ),\n        },\n      }\n    );\n\n    let code_text: HTMLInputElement;\n\n    make_el(code_section, \"strong\", {\n      innerHTML: code_to_show.type,\n      styles: { gridArea: \"code_type\" },\n    });\n\n    make_el(code_section, \"button#copy_code\", {\n      innerHTML: \"Copy to clipboard\",\n      styles: { gridArea: \"copy_btn\" },\n      event_listener: {\n        event: \"click\",\n        func: function () {\n          code_text.select();\n          document.execCommand(\"copy\");\n        },\n      },\n    });\n\n    code_text = make_el(code_section, \"textarea#code_for_layout\", {\n      innerHTML: code_to_show.code,\n      props: { rows: num_of_lines + 3 },\n      styles: {\n        width: \"100%\",\n        background: \"#f3f2f2\",\n        fontFamily: \"monospace\",\n        display: \"block\",\n        padding: \"0.75rem\",\n        marginBottom: \"10px\",\n        borderRadius: \"5px\",\n        gridArea: \"code_text\",\n      },\n    }) as HTMLInputElement;\n  });\n\n  const action_buttons = make_el(code_modal.modal, \"div#action_buttons\", {\n    styles: {\n      display: \"flex\",\n      justifyContent: \"space-around\",\n    },\n  });\n  make_el(action_buttons, \"button#close_code_model\", {\n    innerHTML: \"Close\",\n    event_listener: {\n      event: \"click\",\n      func: close_modal,\n    },\n  });\n\n  function close_modal() {\n    code_modal.remove();\n  }\n}","// Assumes that only one stylesheet has rules for the given selector and\n// that only one rule targeting that selector alone is defined\n// If target_property is provided the function will chose the sheet that defines\n\nimport { flatten } from \"./utils-misc\";\n\n// Combines every style rule contained in all the style sheets on page into\n// a big array. Easier than navigating the nested structure of sheets => rules\nfunction get_all_style_rules() {\n  return flatten(\n    [...document.styleSheets].map((x) => [...x.cssRules]) as CSSStyleRule[][]\n  );\n}\n\nfunction get_all_rules_for_selector(selector_text: string) {\n  // Find the stylesheet which contains the containers styles\n  const defines_ruleset = (selector_text: string) => (rule: CSSRule) =>\n    (rule as CSSStyleRule).selectorText === selector_text;\n\n  return [...document.styleSheets]\n    .filter((style_sheet: CSSStyleSheet) =>\n      [...style_sheet.rules].find(defines_ruleset(selector_text))\n    )\n    .map(\n      (x) =>\n        ([...x.cssRules].find(defines_ruleset(selector_text)) as CSSStyleRule)\n          .style\n    );\n}\n\n// that given property (if multiple exist)\nexport function get_css_props_by_selector(\n  selector_text: string,\n  target_properties: string[],\n) {\n\n  const all_rules_for_selector = get_all_rules_for_selector(selector_text);\n\n  return target_properties.reduce((prop_values, prop) => {\n    const prop_val = all_rules_for_selector.find((rule) => rule[prop])?.[prop];\n\n    if (prop_val) {\n      prop_values[prop] = prop_val;\n    }\n    return prop_values;\n  }, {});\n\n}\n\n\nexport function find_selector_by_property(\n  property_id: string,\n  property_value: string\n): {rule_exists: boolean, selector: string} {\n  const all_styles = get_all_style_rules();\n\n  const first_rule_w_prop = all_styles\n    .filter((rule) => rule.style && rule.style[property_id] == property_value)\n    .find((rule) => document.querySelector(rule.selectorText));\n\n  const rule_exists = Boolean(first_rule_w_prop);\n  return {\n    rule_exists,\n    selector: rule_exists ? first_rule_w_prop.selectorText: \"\"\n  };\n}\n","export const vertical_drag_icon = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M21 11H3V9H21V11M21 13H3V15H21V13Z\" />\n</svg>`;\n\nexport const horizontal_drag_icon = `<svg style=\"width:24px;height:24px;max-height:100%;\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M11 21H9V3H11V21M15 3H13V21H15V3Z\" />\n</svg>`;\n\nexport const trashcan_icon = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z\" />\n</svg>`;\n\nexport const bottom_right_arrow = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M5,6.41L6.41,5L17,15.59V9H19V19H9V17H15.59L5,6.41Z\" />\n</svg>`;\n\nexport const se_arrow = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M5,6.41L6.41,5L17,15.59V9H19V19H9V17H15.59L5,6.41Z\" />\n</svg>`;\n\nexport const nw_arrow = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M19,17.59L17.59,19L7,8.41V15H5V5H15V7H8.41L19,17.59Z\" />\n</svg>`;\n\nexport const top_left_arrow = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M5,6.41L6.41,5L17,15.59V9H19V19H9V17H15.59L5,6.41Z\" />\n</svg>`;\n\nexport const drag_icon = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M22.67,12L18.18,16.5L15.67,14L17.65,12L15.67,10.04L18.18,7.53L22.67,12M12,1.33L16.47,5.82L13.96,8.33L12,6.35L10,8.33L7.5,5.82L12,1.33M12,22.67L7.53,18.18L10.04,15.67L12,17.65L14,15.67L16.5,18.18L12,22.67M1.33,12L5.82,7.5L8.33,10L6.35,12L8.33,13.96L5.82,16.47L1.33,12M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10Z\" />\n</svg>`;\n\nexport const plus_icon = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z\" />\n</svg>`;\n\nexport const minus_icon = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M19,13H5V11H19V13Z\" />\n</svg>`;\n\nexport const settings_icon = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z\" />\n</svg>`;\n\nexport const instructions_icon = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M10,19H13V22H10V19M12,2C17.35,2.22 19.68,7.62 16.5,11.67C15.67,12.67 14.33,13.33 13.67,14.17C13,15 13,16 13,17H10C10,15.33 10,13.92 10.67,12.92C11.33,11.92 12.67,11.33 13.5,10.67C15.92,8.43 15.32,5.26 12,5A3,3 0 0,0 9,8H6A6,6 0 0,1 12,2Z\" />\n</svg>`;\n\nexport const elements_icon = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M12,18.54L19.37,12.8L21,14.07L12,21.07L3,14.07L4.62,12.81L12,18.54M12,16L3,9L12,2L21,9L12,16M12,4.53L6.26,9L12,13.47L17.74,9L12,4.53Z\" />\n</svg>`;\n\nexport const browser_header_html = `<div id=\"buttons-container\">\n  <div></div>\n  <div></div>\n  <div></div>\n</div>\n<div id=\"url-box\">\n  <span> www.myShinyApp.com </span>\n</div>`;","import { Block_El, make_el, Shadow_El } from \"./make-elements\";\n\nexport function make_toggle_switch(\n  off_text: string,\n  on_text: string,\n  on_change: (is_on: boolean) => void\n) {\n\n  const container = Block_El(\"div.toggle-switch\");\n\n  make_el(container, \"span.off-text\", {\n    innerHTML: off_text,\n  });\n  const label = make_el(container, \"label.switch\");\n  make_el(container, \"span.on-text\", {\n    innerHTML: on_text,\n  });\n  make_el(label, \"input\", {\n    props: { type: \"checkbox\" },\n    event_listener: {\n      event: \"change\",\n      func: (event) => {\n        on_change((event.target as HTMLInputElement).checked);\n      },\n    },\n  });\n\n  make_el(label, \"span.slider\");\n\n  const { el, style_sheet } = Shadow_El(\"div.toggle-switch\", container);\n\n  // Add styles\n  style_sheet.innerHTML = toggle_styles;\n\n  return el;  \n}\n\nconst toggle_styles: string = `\ndiv.toggle-switch {\n  display: inline-grid;\n  grid-template-columns: 1fr auto 1fr;\n  grid-gap: 3px;\n  width: 180px;\n  align-items: center;\n  justify-items: center;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n.toggle-switch > span {\n  font-size: 1.2rem;\n}\n\n.toggle-switch > .off-text {\n  text-align: end;\n}\n\n.switch {\n  position: relative;\n  display: inline-block;\n  width: 60px;\n  height: 34px;\n}\n\n.switch input {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n\n.slider {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  border-radius: 34px;\n  background-color: #ccc;\n  -webkit-transition: .4s;\n  transition: .4s;\n}\n\n.slider:before {\n  position: absolute;\n  content: \"\";\n  height: 26px;\n  width: 26px;\n  left: 4px;\n  bottom: 4px;\n  border-radius: 50%;\n  background-color: white;\n  -webkit-transition: .4s;\n  transition: .4s;\n}\n\ninput:checked + .slider {\n  background-color: #2196F3;\n}\n\ninput:focus + .slider {\n  box-shadow: 0 0 1px #2196F3;\n}\n\ninput:checked + .slider:before {\n  -webkit-transform: translateX(26px);\n  -ms-transform: translateX(26px);\n  transform: translateX(26px);\n}\n`;\n","import {\n  browser_header_html,\n  elements_icon,\n  instructions_icon,\n  settings_icon,\n  trashcan_icon,\n} from \"./utils-icons\";\nimport { Block_El, Text_El } from \"./make-elements\";\nimport { make_toggle_switch } from \"./make-toggle_switch\";\n\n// Takes a grid element and wraps it in the grided ui. Also returns some useful\n// information such as if the element passed was empty and if not, the children\n// that it contains so they can be overlayed with editable element boxes \nexport function wrap_in_grided(\n  grid_el: HTMLElement,\n  setShinyInput: (\n    input_id: string,\n    input_value: any,\n    is_event?: boolean\n  ) => void\n) {\n  const grid_is_filled = grid_el.hasChildNodes();\n\n  const buttons = [\n    action_button(\"get_code\", \"Get layout code\"),\n    action_button(\"update_code\", \"Update app\"),\n  ];\n  if (grid_is_filled) {\n    buttons.push(\n      make_toggle_switch(\n        \"Edit layout\",\n        \"Interact mode\",\n        toggle_interaction_mode\n      )\n    );\n  }\n\n  const settings_panel = Block_El(\"div.card-body\");\n  const grided_ui = Block_El(\n    \"div#grided__holder\",\n    Block_El(\n      \"div#grided__header\",\n      Text_El(\n        \"h2\",\n        \"GridEd<sub>(itor)</sub>: Build a grid layout for your Shiny app\"\n      ),\n      Block_El(\"div.code_btns\", ...buttons)\n    ),\n    Block_El(\n      \"div#grided__settings\",\n      Text_El(\"h3\", `${settings_icon} Settings`),\n      settings_panel\n    ),\n    Block_El(\n      \"div#grided__instructions\",\n      Text_El(\"h3\", `${instructions_icon} Instructions`),\n      Text_El(\n        \"div.card-body\",\n        `\n      <strong>Add an element:</strong>\n      <ul>\n        <li>Click and drag over the grid to define a region</li>\n        <li>Enter id of element in popup</li>\n      </ul>\n      <strong>Edit an element:</strong>\n      <ul>\n        <li>Drag the upper left, middle, or bottom right corners of the element to reposition</li>\n      </ul>\n      <strong>Remove an element:</strong>\n      <ul>\n        <li>Find element entry in \"Added elements\" panel and click the ${trashcan_icon} icon</li>\n      </ul>`\n      )\n    ),\n    Block_El(\n      \"div#grided__elements\",\n      Text_El(\"h3\", `${elements_icon} Added elements`),\n      Block_El(\"div.card-body\", Block_El(\"div#added_elements\"))\n    ),\n    Block_El(\n      \"div#grided__editor\",\n      Block_El(\n        \"div#editor-wrapper\",\n        Text_El(\"div#editor-browser-header\", browser_header_html),\n        Block_El(\"div#editor-app-window\", grid_el)\n      )\n    )\n  );\n\n  // Make grided UI direct child of the body\n  document.querySelector(\"body\").appendChild(grided_ui);\n\n  // Setup some basic styles for the container to make sure it fits into the\n  // grided interface properly.\n  grid_el.style.height = \"100%\";\n  grid_el.style.width = \"100%\";\n  grid_el.style.display = \"grid\";\n  // Sometimes RMD styles will put a max-width of some amount which can mess\n  // stuff up on large screens. The tradeoff is that the app may appear wider\n  // than it eventually is. I think it's worth it.\n  grid_el.style.maxWidth = \"100%\";\n\n\n  function toggle_interaction_mode(interact_is_on: boolean) {\n    [\n      ...grid_el.querySelectorAll(\".added-element\"),\n      ...grid_el.querySelectorAll(\".grid-cell\"),\n      settings_panel,\n      grided_ui.querySelector(\"#added_elements\"),\n      grided_ui.querySelector(\"#drag_canvas\"),\n    ].forEach(function (el: Element) {\n      if (interact_is_on) {\n        el.classList.add(\"disabled\");\n      } else {\n        el.classList.remove(\"disabled\");\n      }\n    });\n  }\n\n  function action_button(id: string, label: string) {\n    const button_el = Text_El(`button#${id}`, label);\n    button_el.addEventListener(\"click\", function (event) {\n      setShinyInput(id, 1, true);\n    });\n\n    return button_el;\n  }\n\n  const existing_children = [...grid_el.children].filter((node) => {\n    const bbox = node.getBoundingClientRect();\n    // Only keep visible elements. This will (hopefully) filter out and\n    // script or style tags that find their way into the grid container\n    return bbox.width !== 0 && bbox.height !== 0;\n  });\n\n  return {\n    settings_panel,\n    grid_is_filled,\n    existing_children,\n  };\n}\n","import { Element_Info, Shiny } from \"./index\";\nimport { get_gap_size } from \"./utils-grid\";\n\n// These are functions for communicating with Shiny. They are all optional\n// chained so they won't spit errors if Shiny isn't connected or initialized\n// yet.\n\nexport function setShinyInput(\n  input_id: string,\n  input_value: any,\n  is_event = false\n) {\n  // Sent input value to shiny but only if it's initialized\n  Shiny?.setInputValue?.(\n    input_id,\n    input_value,\n    is_event ? { priority: \"event\" } : {}\n  );\n}\n\nexport function add_shiny_listener(event_id: string, callback_func: Function) {\n  Shiny?.addCustomMessageHandler(event_id, callback_func);\n}\n\nexport function send_grid_sizing_to_shiny(grid_styles: CSSStyleDeclaration) {\n  setShinyInput(\"grid_sizing\", {\n    rows: grid_styles.gridTemplateRows.split(\" \"),\n    cols: grid_styles.gridTemplateColumns.split(\" \"),\n    gap: get_gap_size(grid_styles),\n  });\n}\n\nexport function send_elements_to_shiny(elements: Element_Info[]) {\n  const elements_by_id = {};\n  elements.forEach(function (el) {\n    elements_by_id[el.id] = el;\n  });\n\n  setShinyInput(\"elements\", elements_by_id);\n}\n","import {\n  browser_header_html,\n  horizontal_drag_icon,\n  vertical_drag_icon,\n} from \"./utils-icons\";\nimport { make_el } from \"./make-elements\";\n\nexport type CSS_Input = {\n  form: HTMLElement;\n  current_value: () => string;\n  update_value: (new_value: string) => void;\n};\n\ntype unit_options = \"fr\" | \"px\" | \"rem\" | \"auto\";\n\nconst default_values = {\n  fr: \"1\",\n  px: \"100\",\n  rem: \"2\",\n};\n\nexport function get_css_unit(css_size: string): unit_options {\n  return (css_size.match(/(px|\\%|rem|fr|auto)/g)[0] || \"px\") as unit_options;\n}\n\nexport function get_css_value(css_size: string): number | null {\n  const value = css_size.match(/^[\\d|\\.]*/g)[0];\n  return value === \"\" ? null : Number(value);\n}\n\n// =============================================================================\n// From here on are a series of general purpose helper functions not\n// specifically related to the app and its state\n// Input with value text box on left and unit selector dropdown on right\n// Used to make valid css sizes\nexport function make_css_unit_input({\n  parent_el,\n  selector = \"\",\n  start_val = 1,\n  start_unit = \"fr\",\n  on_change = (x: string) => console.log(\"css unit change\", x),\n  on_drag = on_change,\n  allowed_units = [\"fr\", \"px\", \"rem\", \"auto\"],\n  form_styles = {},\n  drag_dir = \"none\",\n}): CSS_Input {\n  const allow_drag = drag_dir !== \"none\";\n  let current_unit = start_unit;\n\n  const form = make_el(parent_el, `form${selector}.css-unit-input`, {\n    styles: form_styles,\n    event_listener: [\n      { event: \"change\", func: on_update },\n      {\n        event: \"submit\",\n        func: function (e) {\n          // Needed to stop pressing enter causing page to refresh\n          e.preventDefault();\n        },\n      },\n    ],\n  });\n\n  const value_input = <HTMLInputElement>(\n    make_el(form, \"input.css-unit-input-value\", {\n      props: {\n        type: \"number\",\n        min: 0,\n        value: start_val,\n        step: 1,\n        \"aria-live\": \"polite\",\n      },\n    })\n  );\n\n  const unit_selector = <HTMLSelectElement>(\n    make_el(form, \"select.css-unit-input-select\", {\n      props: { name: \"units\" },\n    })\n  );\n\n  const resizer = make_el(form, \"div.css-unit-input-dragger\", {\n    innerHTML: drag_dir === \"y\" ? vertical_drag_icon : horizontal_drag_icon,\n  });\n\n  // Place an invisible div over the main one that we let be dragged. This means\n  // we can use the nice drag interaction callbacks without the ugly default\n  // drag behavior of two copies of the div and zooming back to the start pos etc.\n  make_el(resizer, \"div.css-unit-input-drag-detector\", {\n    props: { draggable: true },\n    event_listener: [\n      {\n        event: \"dragstart\",\n        func: function (event) {\n          this.dataset.baseline = value_input.value;\n          this.dataset.start = event[drag_dir];\n        },\n      },\n      {\n        event: \"drag\",\n        func: function (event) {\n          const drag_pos = event[drag_dir];\n          // At the end of the drag we get a drag event with 0 values that throws stuff off\n          if (drag_pos === 0) return;\n          const new_value = Math.max(\n            0,\n            +this.dataset.baseline + (event[drag_dir] - this.dataset.start)\n          );\n          value_input.value = new_value.toString();\n          on_drag();\n        },\n      },\n      {\n        event: \"dragend\",\n        func: function (event) {\n          on_change(current_value());\n        },\n      },\n    ],\n  });\n\n  allowed_units.forEach(function (unit_type) {\n    const unit_option = <HTMLOptionElement>(\n      make_el(unit_selector, `option.${unit_type}`, {\n        props: { value: unit_type },\n        innerHTML: unit_type,\n      })\n    );\n\n    if (unit_type === start_unit) {\n      unit_option.selected = true;\n    }\n  });\n\n  function unit_type(): unit_options {\n    return unit_selector.value as unit_options;\n  }\n  function num_units() {\n    return value_input.value;\n  }\n  function current_value() {\n    if (unit_type() === \"auto\") return \"auto\";\n    return `${num_units()}${unit_type()}`;\n  }\n\n  function on_update() {\n    const val = current_value();\n    update_value(val);\n    on_change(val);\n  }\n\n  function update_value(new_value: string) {\n    const units = get_css_unit(new_value);\n    const count = get_css_value(new_value);\n\n    if (count === null && units === \"auto\") {\n      // Using a unit without values so disable value input\n      value_input.classList.add(\"disabled\");\n      value_input.value = \"\";\n    } else {\n      value_input.classList.remove(\"disabled\");\n    \n      // If the user is flipping through multiple units we dont want to just \n      // stick to whatever value was last set as the unit unless they've changed\n      // it from the default. E.g. flipping from default of 100px to rem \n      // shouldn't result in a 100rem wide track which then needs to be adjusted\n      const using_old_units_default = value_input.value === default_values[current_unit];\n      value_input.value =\n        count === null || using_old_units_default \n        ? default_values[units] \n        : count.toString();\n    }\n\n    for (let opt of unit_selector.children as HTMLCollectionOf<\n      HTMLOptionElement\n    >) {\n      opt.selected = opt.value === units;\n    }\n\n    if (units === \"px\" && allow_drag) {\n      form.classList.add(\"with-drag\");\n    } else {\n      form.classList.remove(\"with-drag\");\n    }\n\n    current_unit = units;\n  }\n\n  update_value(`${start_val}${start_unit}`);\n\n  return { form, current_value, update_value };\n}\n","import { minus_icon, plus_icon } from \"./utils-icons\";\nimport { make_el } from \"./make-elements\";\n\n// Builds an up down button and value input\nexport function make_incrementer({\n  parent_el,\n  start_val = 2,\n  id = \"incrementer\",\n  label = \"my incrementer\",\n  on_increment = (x) => console.log(x),\n}): (new_value: number) => void {\n  let current_value: number = start_val;\n  const plus_minus_div = make_el(\n    parent_el,\n    `div#${id}_incrementer.plus-minus-input.settings-grid`,\n    {\n      innerHTML: `<span class = \"input-label\">${label}</span>`,\n    }\n  );\n\n  const inputs_div = make_el(plus_minus_div, \"div.plus-minus-input-controls\");\n\n  const minus_btn = make_el(inputs_div, \"button.plus-minus-input-btn.minus\", {\n    props: { name: \"plus button\" },\n    innerHTML: minus_icon,\n    event_listener: {\n      event: \"click\",\n      func: increment_counter(-1),\n    },\n  });\n\n  const value_label = make_el(inputs_div, \"span.plus-minus-input-value\", {\n    innerHTML: start_val.toString(),\n  });\n\n  make_el(inputs_div, \"button.plus-minus-input-btn.plus\", {\n    props: { name: \"minus button\" },\n    innerHTML: plus_icon,\n    event_listener: {\n      event: \"click\",\n      func: increment_counter(1),\n    },\n  });\n\n  function update_value(new_value: number) {\n    // Dont waste time if value hasn't changed\n    if (current_value == new_value) return;\n\n    value_label.innerHTML = new_value.toString();\n\n    if (new_value === 1) {\n      minus_btn.classList.add(\"disabled\");\n    } else {\n      minus_btn.classList.remove(\"disabled\");\n    }\n\n    current_value = new_value;\n  }\n  function increment_counter(amount) {\n    return function () {\n      const new_value = +value_label.innerHTML + amount;\n\n      update_value(new_value);\n      on_increment(new_value);\n    };\n  }\n\n  return update_value;\n}\n","import { Element_Opts, make_el, remove_elements } from \"./make-elements\";\nimport {\n  CSS_Input,\n  get_css_unit,\n  get_css_value,\n  make_css_unit_input,\n} from \"./make-css_unit_input\";\nimport {\n  as_array,\n  Drag_Type,\n  filler_text,\n  get_bounding_rect,\n  Selection_Rect,\n  update_rect_with_delta,\n  XY_Pos,\n} from \"./utils-misc\";\nimport {\n  send_elements_to_shiny,\n  send_grid_sizing_to_shiny,\n} from \"./utils-shiny\";\nimport { Shiny, Element_Info } from \"./index\";\nimport {\n  bounding_rect_to_css_pos,\n  get_cols,\n  get_drag_extent_on_grid,\n  get_gap_size,\n  get_pos_on_grid,\n  get_rows,\n  make_template_start_end,\n  set_element_in_grid,\n  set_gap_size,\n  sizes_to_template_def,\n} from \"./utils-grid\";\nimport { drag_icon, nw_arrow, se_arrow, trashcan_icon } from \"./utils-icons\";\nimport { focused_modal } from \"./make-focused_modal\";\nimport { make_incrementer } from \"./make-incrementer\";\n\ntype Grid_Settings = {\n  num_rows: (new_value: number) => void;\n  num_cols: (new_value: number) => void;\n  gap: CSS_Input;\n};\n\nexport type Grid_Pos = {\n  start_col?: number;\n  end_col?: number;\n  start_row?: number;\n  end_row?: number;\n};\n\ntype Grid_Update_Options = {\n  rows?: string[];\n  cols?: string[];\n  gap?: string;\n  force?: boolean;\n  dont_send_to_shiny?: boolean;\n};\n\ntype Drag_Res = {\n  xy: XY_Pos;\n  grid: Grid_Pos;\n};\n\ntype Drag_Options = {\n  watching_element: HTMLElement;\n  drag_dir: Drag_Type;\n  grid_element?: HTMLElement;\n  on_start?: (start_loc: XY_Pos) => void;\n  on_drag?: (drag_info: Drag_Res) => void;\n  on_end?: (drag_info: Drag_Res) => void;\n};\n\ntype New_Element = {\n  id: string;\n  color?: string;\n  grid_pos: Grid_Pos;\n  existing_element?: HTMLElement;\n};\n\ntype Element_Entries = {\n  grid_el: HTMLElement;\n  list_el: HTMLElement;\n};\n\nexport class App_State {\n  controls: { rows: CSS_Input[]; cols: CSS_Input[] };\n  settings_panel: Grid_Settings;\n  // All the currently existing cells making up the grid\n  current_cells: HTMLElement[] = [];\n  elements: Record<string, Element_Entries> = {};\n\n  container: HTMLElement;\n  grid_styles: CSSStyleDeclaration;\n  mode: \"ShinyExisting\" | \"ShinyNew\" | \"ClientSide\";\n\n  constructor(opts: {\n    controls: { rows: CSS_Input[]; cols: CSS_Input[] };\n    settings_panel: HTMLElement;\n    container: HTMLElement;\n    grid_is_filled: boolean;\n  }) {\n    this.controls = opts.controls;\n    this.container = opts.container;\n    this.grid_styles = this.container.style;\n    this.mode = opts.grid_is_filled\n      ? \"ShinyExisting\"\n      : Shiny\n      ? \"ShinyNew\"\n      : \"ClientSide\";\n    this.settings_panel = make_settings_panel(this, opts.settings_panel);\n\n    console.log(\"Hi app state\");\n  }\n\n  get layout_from_controls() {\n    const sizes = {};\n    for (let type in this.controls) {\n      sizes[type] = this.controls[type].map((unit_input: CSS_Input) =>\n        unit_input.current_value()\n      );\n    }\n    return sizes;\n  }\n\n  get row_sizes() { return get_rows(this.container); }\n  get col_sizes() { return get_cols(this.container); }\n  get num_rows() { return this.row_sizes.length; }\n  get num_cols() { return this.col_sizes.length; }\n\n  get gap_size() {return get_gap_size(this.grid_styles);}\n\n  get grid_dims() {\n    return {\n      rows: this.row_sizes,\n      cols: this.col_sizes,\n    };\n  }\n\n  get num_elements(): number {\n    return Object.keys(this.elements).length;\n  }\n\n  get current_elements(): Element_Info[] {\n    const all_elements = [...Object.values(this.elements)].map(\n      ({ grid_el }) => {\n        const grid_area = grid_el.style.gridArea.split(\" / \");\n        return {\n          id: grid_el.id,\n          start_row: +grid_area[0],\n          start_col: +grid_area[1],\n          // Subtract one here because the end in css is the end line, not row\n          end_row: +grid_area[2] - 1,\n          end_col: +grid_area[3] - 1,\n        };\n      }\n    );\n\n    return all_elements;\n  }\n\n  // Get the next color in our list of colors.\n  get next_color() {\n    const colors = [\n      \"#e41a1c\",\n      \"#377eb8\",\n      \"#4daf4a\",\n      \"#984ea3\",\n      \"#ff7f00\",\n      \"#a65628\",\n      \"#f781bf\",\n    ];\n    // If we have more elements than colors we simply recycle\n    return colors[this.num_elements % colors.length];\n  }\n\n  // Just so we dont have to always say make_el(this.container...)\n  make_el(sel_txt: string, opts?: Element_Opts) {\n    return make_el(this.container, sel_txt, opts);\n  }\n\n  // Removes elements the user has added to the grid by id\n  remove_elements(ids: string | Array<string>) {\n    as_array(ids).forEach((el_id) => {\n      remove_elements(\n        document.querySelectorAll(`div.el_${el_id}.added-element`)\n      );\n    });\n\n    send_elements_to_shiny(this.current_elements);\n  }\n\n  setup_drag(opts: Drag_Options) {\n    let drag_feedback_rect: HTMLElement;\n    let start_rect: Selection_Rect;\n    let start_loc: XY_Pos;\n\n    const editor_el: HTMLElement = document.querySelector(\"#grided__editor\");\n\n    const update_grid_pos = (\n      element: HTMLElement,\n      bounding_rect: Selection_Rect\n    ): Grid_Pos => {\n      const grid_extent = get_drag_extent_on_grid(this, bounding_rect);\n      set_element_in_grid(element, grid_extent);\n      return grid_extent;\n    };\n\n    opts.watching_element.onmousedown = (event: MouseEvent) => {\n      start_loc = event as DragEvent;\n\n      // make sure dragged element is on top\n      this.container.appendChild(opts.grid_element);\n\n      // If this is a new element drag there wont be a bounding box for the grid\n      // element yet, so we need to make a new zero-width/height one at start\n      // of the drag\n      start_rect = get_bounding_rect(opts.grid_element) || {\n        left: event.offsetX,\n        right: event.offsetX,\n        top: event.offsetY,\n        bottom: event.offsetY,\n      };\n\n      drag_feedback_rect = make_el(\n        this.container.querySelector(\"#drag_canvas\"),\n        \"div.drag-feedback-rect\",\n        {\n          styles: {\n            ...bounding_rect_to_css_pos(start_rect),\n          },\n        }\n      );\n\n      // We start grid position here in case user selects by simply clicking,\n      // which would mean we never get to run the drag function\n      update_grid_pos(opts.grid_element, start_rect);\n\n      if (opts.on_start) opts.on_start(start_loc);\n\n      // Add listener to editor so we can continue to track this drag\n      editor_el.addEventListener(\"mousemove\", drag);\n      editor_el.addEventListener(\"mouseup\", drag_end);\n    };\n\n    function drag(event: MouseEvent) {\n      const curr_loc: XY_Pos = event;\n      // Sometimes the drag event gets fired with nonsense zeros\n      if (curr_loc.x === 0 && curr_loc.y === 0) return;\n\n      const new_rect = update_rect_with_delta(\n        start_rect,\n        { x: curr_loc.x - start_loc.x, y: curr_loc.y - start_loc.y },\n        opts.drag_dir\n      );\n\n      Object.assign(\n        drag_feedback_rect.style,\n        bounding_rect_to_css_pos(new_rect)\n      );\n      const grid_extent = update_grid_pos(opts.grid_element, new_rect);\n      if (opts.on_drag) opts.on_drag({ xy: curr_loc, grid: grid_extent });\n    }\n\n    function drag_end(event: MouseEvent) {\n      const end_loc: XY_Pos = event;\n      drag_feedback_rect.remove();\n      start_rect = null;\n      start_loc = null;\n      if (opts.on_end)\n        opts.on_end({\n          xy: end_loc,\n          grid: get_pos_on_grid(opts.grid_element || this.parentElement),\n        });\n\n      editor_el.removeEventListener(\"mousemove\", drag);\n      editor_el.removeEventListener(\"mouseup\", drag_end);\n    }\n  }\n\n  add_element(el_props: New_Element) {\n    // If element ids were generated with the grid_container R function then\n    // they have a prefix of the container name which we should remove so the\n    // added elements list is not ugly looking\n    if (el_props.existing_element) {\n      el_props.id = el_props.id.replace(/^.+?__/g, \"\");\n    }\n\n    this.elements[el_props.id] = draw_elements(this, el_props);\n\n    // Let shiny know we have a new element\n    send_elements_to_shiny(this.current_elements);\n  }\n\n  update_grid(opts: Grid_Update_Options) {\n\n    const new_num_rows = opts.rows ? opts.rows.length : this.num_rows;\n    const new_num_cols = opts.cols ? opts.cols.length : this.num_cols;\n  \n    // Make sure settings panel is up-to-date\n    this.settings_panel.num_rows(new_num_rows);\n    this.settings_panel.num_cols(new_num_cols);\n    this.settings_panel.gap.update_value(opts.gap || this.gap_size);\n  \n    const grid_numbers_changed =\n    this.num_rows !== new_num_rows || this.num_cols !== new_num_cols;\n    if (grid_numbers_changed) {\n      // Check for elements that may get dropped\n      let in_danger_els: Element_Info[] = [];\n      let auto_removed_el_ids: string[] = [];\n  \n      this.current_elements.forEach(function (el) {\n        const sits_outside_grid =\n          el.end_row > new_num_rows || el.end_col > new_num_cols;\n        const completely_outside_grid =\n          el.start_row > new_num_rows || el.start_col > new_num_cols;\n        if (completely_outside_grid) {\n          auto_removed_el_ids.push(el.id);\n        } else if (sits_outside_grid) {\n          in_danger_els.push(el);\n        }\n      });\n  \n      this.remove_elements(auto_removed_el_ids);\n  \n      if (in_danger_els.length > 0) {\n\n        show_danger_popup(this, in_danger_els, (to_edit) => {\n          to_edit.forEach((el) => {\n            const el_node: HTMLElement = this.container.querySelector(\n              `#${el.id}`\n            );\n\n            el_node.style.gridRow = make_template_start_end(\n              el.start_row,\n              Math.min(el.end_row, new_num_rows)\n            );\n            el_node.style.gridColumn = make_template_start_end(\n              el.start_col,\n              Math.min(el.end_col, new_num_cols)\n            );\n          });\n          // Now that we've updated elements properly, we should be able to\n          // just recall the function and it won't spit an error\n          this.update_grid({\n            rows: opts.rows,\n            cols: opts.cols,\n            gap: opts.gap,\n          });\n        });\n\n        return;\n      }\n    }\n  \n    if (opts.rows) {\n      this.grid_styles.gridTemplateRows = sizes_to_template_def(\n        opts.rows\n      );\n    }\n    if (opts.cols) {\n      this.grid_styles.gridTemplateColumns = sizes_to_template_def(\n        opts.cols\n      );\n    }\n    if (opts.gap) {\n      // This sets the --grid-gap variable so that the controls that need the\n      // info can use it to keep a constant distance from the grid holder\n      this.container.parentElement.style.setProperty(\"--grid-gap\", opts.gap);\n      // We dont use css variables in the exported css that existing apps used\n      // so we need to modify both gap and padding\n      set_gap_size(this.grid_styles, opts.gap);\n      this.grid_styles.padding = opts.gap;\n    }\n  \n    if (grid_numbers_changed || opts.force) {\n      this.fill_grid_cells();\n    }\n  \n    if (!opts.dont_send_to_shiny) {\n      send_grid_sizing_to_shiny(this.grid_styles);\n    }  \n  }\n\n  fill_grid_cells() {\n    // Grab currently drawn cells (if any) so we can check if we need to redraw\n    // or if this was simply a column/row sizing update\n    const need_to_reset_cells =\n      this.current_cells.length != this.num_rows * this.num_cols;\n\n    if (need_to_reset_cells) {\n      remove_elements(this.current_cells);\n      this.current_cells = [];\n\n      for (let row_i = 1; row_i <= this.num_rows; row_i++) {\n        for (let col_i = 1; col_i <= this.num_cols; col_i++) {\n          this.current_cells.push(\n            this.make_el(`div.r${row_i}.c${col_i}.grid-cell`, {\n              data_props: { row: row_i, col: col_i },\n              grid_pos: { start_row: row_i, start_col: col_i },\n            })\n          );\n        }\n      }\n\n      // Build each column and row's sizing controler\n      for (let type in this.controls) {\n        // Get rid of old ones to start with fresh slate\n        remove_elements(this.container.querySelectorAll(`.${type}-controls`));\n        this.controls[type] = this.grid_dims[type].map(\n          (size: string, i: number) => {\n            // The i + 1 is because grid is indexed at 1, not zero\n            const grid_i = i + 1;\n\n            return make_css_unit_input({\n              parent_el: this.container,\n              selector: `#control_${type}${grid_i}.${type}-controls`,\n              start_val: get_css_value(size),\n              start_unit: get_css_unit(size),\n              on_change: () => this.update_grid(this.layout_from_controls),\n              on_drag: () =>\n                this.update_grid({\n                  ...this.layout_from_controls,\n                  dont_send_to_shiny: true,\n                }),\n              form_styles: {\n                [`grid${\n                  type === \"rows\" ? \"Row\" : \"Column\"\n                }`]: make_template_start_end(grid_i),\n              },\n              drag_dir: type === \"rows\" ? \"y\" : \"x\",\n            });\n          }\n        );\n      }\n      const current_selection_box = this.make_el(\n        \"div#current_selection_box.added-element\"\n      );\n      const drag_canvas = this.make_el(\"div#drag_canvas\");\n\n      this.setup_drag({\n        watching_element: drag_canvas,\n        grid_element: current_selection_box,\n        drag_dir: \"bottom-right\",\n        on_start: () => {\n          current_selection_box.style.borderColor = this.next_color;\n        },\n        on_end: ({ grid }) => {\n          name_new_element(this, {\n            grid_pos: grid,\n            selection_box: current_selection_box,\n          });\n        },\n      });\n\n      // Make sure any added elements sit on top by re-appending them to grid holder\n      // Make sure that the drag detector sits over everything\n      [\n        drag_canvas,\n        ...this.container.querySelectorAll(\".added-element\"),\n      ].forEach((el) => this.container.appendChild(el));\n    } else {\n    }\n  }\n} // End of class declaration\n\nfunction make_settings_panel(\n  app_state: App_State,\n  panel_el: HTMLElement\n): Grid_Settings {\n  return {\n    num_rows: make_incrementer({\n      parent_el: panel_el,\n      id: \"num_rows\",\n      start_val: 2,\n      label: \"Number of rows\",\n      on_increment: (x) => update_num_rows_or_cols(\"rows\", x),\n    }),\n    num_cols: make_incrementer({\n      parent_el: panel_el,\n      id: \"num_cols\",\n      start_val: 2,\n      label: \"Number of cols\",\n      on_increment: (x) => update_num_rows_or_cols(\"cols\", x),\n    }),\n    gap: make_css_unit_input({\n      parent_el: make_el(\n        panel_el,\n        \"div#gap_size_chooser.plus_minus_input.settings-grid\",\n        {\n          innerHTML: `<span class = \"input-label\">Panel gap size</span>`,\n        }\n      ),\n      selector: \"#gap_size_chooser\",\n      on_change: (x) => app_state.update_grid({ gap: x }),\n      allowed_units: [\"px\", \"rem\"],\n    }),\n  };\n\n  function update_num_rows_or_cols(dir, new_count) {\n    const current_vals = app_state.container.style[\n      `gridTemplate${dir === \"rows\" ? \"Rows\" : \"Columns\"}`\n    ].split(\" \");\n\n    if (new_count > current_vals.length) {\n      current_vals.push(\"1fr\");\n    } else if (new_count < current_vals.length) {\n      current_vals.pop();\n    } else {\n      // No change, shouldn't happen but maybe...\n    }\n    app_state.update_grid({ [dir]: current_vals });\n  }\n}\n\nfunction name_new_element(app_state: App_State, { grid_pos, selection_box }) {\n  const modal_divs = focused_modal({\n    background_callbacks: {\n      // Clicking outside of the modal will cancel the naming. Seems natural\n      event: \"click\",\n      func: reset_el_creation,\n    },\n    modal_callbacks: {\n      event: \"click\",\n      func: function (event) {\n        // This is needed to stop clicks on modal from triggering the cancel\n        // event that is attached to the background\n        event.stopPropagation();\n      },\n    },\n  });\n\n  const modal_div = modal_divs.modal;\n\n  make_el(modal_div, \"div.instructions\", {\n    innerHTML: `\n    <h2>Name your element:</h2>\n    <p>This name will be used to place items in your app.\n    For instance if you want to place a plot in this element,\n    this name will match the label of the plot output\n    </p>\n    `,\n  });\n\n  const name_form = make_el(modal_div, \"form#name_form\", {\n    event_listener: {\n      event: \"submit\",\n      func: function (event) {\n        event.preventDefault();\n        const id = this[\"name_input\"].value.replace(/\\s/g, \"_\");\n\n        // Can be replaced with better function operating directly on elements dict\n        const element_exists: boolean = !!app_state.current_elements.find(\n          (el) => el.id === id\n        );\n\n        if (element_exists) {\n          // Cant have duplicate ids!\n          warn_about_bad_id(\n            `You already have an element with the id ${id}, all ids need to be unique.`\n          );\n          return;\n        }\n        if (id.match(/^[^a-zA-Z]/g)) {\n          warn_about_bad_id(`Valid ids need to start with a character.`);\n          return;\n        }\n\n        // Add the new element in to grid\n        app_state.add_element({\n          id,\n          color: selection_box.style.borderColor,\n          grid_pos,\n        });\n\n        reset_el_creation();\n      },\n    },\n  });\n  make_el(name_form, \"input#cancel_btn\", {\n    props: { type: \"button\", value: \"cancel\" },\n    event_listener: { event: \"click\", func: reset_el_creation },\n  });\n\n  make_el(name_form, \"input#name_input\", {\n    props: { type: \"text\" },\n    event_listener: {\n      // Don't leave warning message up while user is typing\n      event: \"input\",\n      func: hide_warning_msg,\n    },\n  }).focus(); // So user can immediately type in id\n\n  make_el(name_form, \"input#name_submit\", {\n    props: { type: \"submit\" },\n  });\n\n  function warn_about_bad_id(msg) {\n    make_el(modal_div, \"span#bad_id_msg.notice-text\", {\n      innerHTML: msg,\n      styles: { color: \"orangered\" },\n    });\n  }\n  function hide_warning_msg() {\n    const warn_msg = modal_div.querySelector(\"span#bad_id_msg\");\n    if (warn_msg) {\n      warn_msg.remove();\n    }\n  }\n  function reset_el_creation() {\n    // All done here so get rid of the whole interface.\n    modal_divs.remove();\n    // Remove the temporary dragged element\n    selection_box.style.display = \"none\";\n  }\n}\n\nfunction draw_elements(app_state: App_State, el_props: New_Element) {\n  const el_color = app_state.next_color;\n  const grid_el = app_state.make_el(\n    `div#${el_props.id}.el_${el_props.id}.added-element`,\n    {\n      grid_pos: el_props.grid_pos,\n      // Add filler text for new elements so that auto-height will work\n      innerHTML: el_props.existing_element ? \"\" : filler_text,\n      styles: {\n        borderColor: el_color,\n        position: \"relative\",\n      },\n    }\n  );\n\n  // Setup drag behavior\n  ([\"top-left\", \"bottom-right\", \"center\"] as Drag_Type[]).forEach(\n    (handle_type: Drag_Type) => {\n      app_state.setup_drag({\n        watching_element: make_el(\n          grid_el,\n          `div.dragger.visible.${handle_type}`,\n          {\n            styles: { background: el_color },\n            innerHTML:\n              handle_type === \"center\"\n                ? drag_icon\n                : handle_type === \"bottom-right\"\n                ? se_arrow\n                : nw_arrow,\n          }\n        ),\n        grid_element: grid_el,\n        drag_dir: handle_type,\n        on_drag: (res) => {\n          if (el_props.existing_element) {\n            set_element_in_grid(el_props.existing_element, res.grid);\n          }\n        },\n        on_end: () => {\n          send_elements_to_shiny(app_state.current_elements);\n        },\n      });\n    }\n  );\n\n  const list_el = make_el(\n    document.querySelector(\"#added_elements\"),\n    `div.el_${el_props.id}.added-element`,\n    {\n      innerHTML: el_props.id,\n      styles: { borderColor: el_color },\n      event_listener: [\n        {\n          event: \"mouseover\",\n          func: function () {\n            this.classList.add(\"hovered\");\n            grid_el.classList.add(\"hovered\");\n          },\n        },\n        {\n          event: \"mouseout\",\n          func: function () {\n            this.classList.remove(\"hovered\");\n            grid_el.classList.remove(\"hovered\");\n          },\n        },\n      ],\n    }\n  );\n\n  if (!el_props) {\n    // Turn of deleting if were editing an existing app\n    // This means that if were in app editing mode and the user adds a new element\n    // they can delete that new element but they can't delete the existing elements\n    make_el(list_el, \"button.remove_el\", {\n      innerHTML: trashcan_icon,\n      event_listener: {\n        event: \"click\",\n        func: () => {\n          this.remove_elements(el_props.id);\n        },\n      },\n    });\n  }\n\n  return { grid_el, list_el };\n}\n\nfunction show_danger_popup(\n  app_state: App_State, \n  in_danger_els: Element_Info[],\n  on_finish: (to_edit: Element_Info[]) => void){\n  const fix_els_modal = focused_modal({\n    header_text: `\n  <h2>The following elements dont fit on the new grid layout.</h2>\n  <p>Below, choose to either remove the element or to shink its bounds to the new grid sizing</p>\n  `,\n  });\n\n  const radio_inputs_html = in_danger_els.reduce(\n    (radio_group, el) =>\n      `\n    ${radio_group}\n    <div class = \"radio-set-group\">\n      <div class = \"radio-set-label\"> ${el.id} </div>\n      <div class = \"radio-set-options\">\n        <input type=\"radio\" id = \"delete_${el.id}\" name=\"${el.id}\" value=\"delete\" checked>\n        <label for=\"delete_${el.id}\">Delete</label>\n        <input type=\"radio\" id = \"shrink_${el.id}\" name=\"${el.id}\" value=\"shrink\">\n        <label for=\"shrink_${el.id}\">Shink</label>\n      </div>\n    </div>\n  `,\n    \"\"\n  );\n\n  const delete_or_edit_form = make_el(\n    fix_els_modal.modal,\n    \"form#delete_or_fix_list\",\n    {\n      innerHTML: `<div class = \"update-action-form\"> ${radio_inputs_html} </div>`,\n      event_listener: {\n        event: \"submit\",\n        func: function () {\n          const form = this;\n          const to_delete = in_danger_els.filter(\n            (d) => form[d.id].value === \"delete\"\n          );\n\n          app_state.remove_elements(to_delete.map((d) => d.id));\n          const to_edit = in_danger_els.filter(\n            (d) => form[d.id].value === \"shrink\"\n          );\n\n          on_finish(to_edit);\n\n          fix_els_modal.remove();\n          \n        },\n      },\n    }\n  );\n\n  make_el(delete_or_edit_form, \"input#name_submit\", {\n    props: { type: \"submit\" },\n  });\n\n  make_el(fix_els_modal.modal, \"p.notice-text\", {\n    innerHTML:\n      \"Note that elements residing completely in the removed row or column are automatically deleted.\",\n  });\n}","// JS entry point\nimport { Block_El } from \"./make-elements\";\nimport { show_code } from \"./make-focused_modal\";\n\nimport { set_class } from \"./utils-misc\";\nimport {\n  get_pos_on_grid,\n  gen_code_for_layout,\n  set_gap_size,\n  get_gap_size,\n} from \"./utils-grid\";\nimport {\n  find_selector_by_property,\n  get_css_props_by_selector,\n} from \"./utils-cssom\";\nimport { wrap_in_grided } from \"./wrap_in_grided\";\nimport {\n  add_shiny_listener,\n  send_elements_to_shiny,\n  send_grid_sizing_to_shiny,\n  setShinyInput,\n} from \"./utils-shiny\";\nimport { App_State } from \"./App_State\";\n\nexport const Shiny = (window as any).Shiny;\n\nexport type Element_Info = {\n  id: string;\n  start_row: number;\n  end_row: number;\n  start_col: number;\n  end_col: number;\n};\n\nconst debug_messages = true;\n\nwindow.onload = function () {\n  // Do we already have a div with id grid_page in our app? Aka the grided UI\n  // has been already added?\n  const grid_layout_rule = find_selector_by_property(\"display\", \"grid\");\n\n  const grid_container_selector = grid_layout_rule.rule_exists\n    ? grid_layout_rule.selector\n    : \"#grid_page\";\n\n  // This holds the grid element dom node. Gets filled in the onload callback\n  // I am using a global variable here because we query inside this so much that\n  // it felt silly to regrab it every time as it never moves.\n  const container: HTMLElement = grid_layout_rule.rule_exists\n    ? document.querySelector(grid_container_selector)\n    : Block_El(\"div#grid_page\");\n\n  const { grid_is_filled, existing_children, settings_panel } = wrap_in_grided(\n    container,\n    setShinyInput\n  );\n\n  const app_state = new App_State({\n    controls: { rows: [], cols: [] },\n    settings_panel,\n    container,\n    grid_is_filled,\n  });\n\n  // Only set a default gap sizing if it isn't already provided\n  if (app_state.mode !== \"ShinyExisting\") {\n    set_gap_size(app_state.container.style, \"1rem\");\n    app_state.container.style.padding = \"1rem\";\n  }\n\n  add_shiny_listener(\"shiny-loaded\", function (event) {\n    if (debug_messages) console.log(\"connected to shiny\");\n    // Send elements to Shiny so app is aware of what it's working with\n    send_elements_to_shiny(app_state.current_elements);\n    send_grid_sizing_to_shiny(app_state.container.style);\n  });\n\n  add_shiny_listener(\"finish-button-text\", function (label_text: string) {\n    document.querySelector(\"button#update_code\").innerHTML = label_text;\n  });\n\n  if (app_state.mode === \"ShinyExisting\") {\n    // If grided is running on an existing app, we need to parse the children and\n    // add them as elements;\n    existing_children.forEach(function (el) {\n      app_state.add_element({\n        id: el.id,\n        grid_pos: get_pos_on_grid(el as HTMLElement),\n        existing_element: el as HTMLElement,\n      });\n    });\n\n    // Container styles are in this object\n    const current_grid_props: {\n      gridTemplateRows?: string;\n      gridTemplateColumns?: string;\n      gap?: string;\n    } = get_css_props_by_selector(grid_container_selector, [\n      \"gridTemplateColumns\",\n      \"gridTemplateRows\",\n      \"gap\",\n    ]);\n\n    // Make sure grid matches the one the app is working with\n    app_state.update_grid({\n      rows: current_grid_props.gridTemplateRows.split(\" \"),\n      cols: current_grid_props.gridTemplateColumns.split(\" \"),\n      gap: get_gap_size(current_grid_props.gap),\n      force: true,\n    });\n\n    // Make grid cells transparent so the app is seen beneath them\n    set_class(\n      app_state.container.querySelectorAll(\".grid-cell\"),\n      \"transparent\"\n    );\n  } else if (app_state.mode === \"ShinyNew\") {\n    add_shiny_listener(\"update-grid\", app_state.update_grid);\n\n    add_shiny_listener(\"add-elements\", function (\n      elements_to_add: Element_Info[]\n    ) {\n      elements_to_add.forEach((el: Element_Info) => {\n        app_state.add_element({\n          id: el.id,\n          grid_pos: el,\n        });\n      });\n    });\n  } else {\n    // If in pure-client-side mode we need to provide a default grid and also wireup the code button\n    app_state.update_grid({\n      rows: [\"1fr\", \"1fr\"],\n      cols: [\"1fr\", \"1fr\"],\n      gap: \"1rem\",\n    });\n\n    document.getElementById(\"get_code\").addEventListener(\"click\", function () {\n      show_code(\n        \"Place the following in your CSS:\",\n        gen_code_for_layout(\n          app_state.current_elements,\n          app_state.container.style\n        )\n      );\n    });\n  }\n\n  add_shiny_listener(\"code_modal\", function (code_to_show) {\n    show_code(\"Paste the following code into your app to update the layout\", {\n      type: \"R\",\n      code: code_to_show,\n    });\n  });\n\n  add_shiny_listener(\"code_update_problem\", function (code_to_show) {\n    show_code(\n      \"Sorry, Couldn't find your layout to update. Make sure it's in the foreground of RStudio. Here's the code to paste in case all else fails.\",\n      {\n        type: \"R\",\n        code: code_to_show,\n      }\n    );\n  });\n}; // End of the window.onload callback\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel]  Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel]   ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\"></span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}