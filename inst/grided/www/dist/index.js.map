{"version":3,"sources":["misc-helpers.ts","make_el.ts","icons.ts","make_incrementer.ts","focused_modal.ts","make_css_unit_input.ts","make_toggle_switch.ts","find_rules_by_selector.ts","index.ts"],"names":[],"mappings":";;;;;;AEAa,OAAA,CAAA,kBAAA,GAAqB,+IAArB;AEAb,AFIa,AGJb,AFAA,AGAA,IFAA,ACAA,AFAA,AGAA,GJIa,CAAA,GGJb,AFAA,ECAA,AEAA,CDAA,AFAA,ECAA,AEAA,KDAA,AFAA,CEAA,AFAA,CCAA,AEAA,CFAA,AEAA,IJIa,GAAuB,AGJpC,AFAA,CEAA,AFAA,GCAA,AEAA,CFAA,AEAA,0JJIa;AAIA,OAAA,CAAA,aAAA,GAAgB,8LAAhB;AEDb,AFKa,AGXb,AFAA,AGCA,IDDA,AFAA,GDWa,CAAA,CELG,AELA,IDDhB,AFAA,GEAA,AFAA,MCMA,CAA8B,ACN9B,AFAA,CEAA,AFAA,EDWa,CELb,AELA,CACE,CFI+C,AFKf,KIVlC,CDDA,AFAA,CEAA,AFAA,AGGE,EHDF,MGDA,EAGE,OAHF,EAIE,SAJF,EAIqC,0HJMxB;AEJX,AFQW,AIRX,MFAM,AEAA,CJQK,CAAA,OIRI,CFAC,AFQL,EIRO,CFAC,AFQG,QIRJ,CFAC,AEAD,CFAC,MEAD,CFAC,AEAO,CFCxB,KEDgB,EAAgB,CFCxB,CAAC,aAAT,CAAuB,GEDP,CAAlB,EFCE,CADiB,EAEjB,wBAFiB,EAGjB,mFFKS;AEJP,AFQO,AGlBb,ACOE,EAAA,EFGI,ACVN,GHkBa,CAAA,GIXX,CAAA,IJWW,EERO,ACVpB,CHkBwB,AIXtB,CFGoB,AEHZ,CDPV,GDU0B,CAAC,GCV3B,CAAA,ACOE,EAAmB,cDPrB,CAAA,ACOE,EDAF,ACAsC,oIJWzB;AETT,AFaS,AGdb,AFNA,AGMI,GFFiB,CAAnB,AEEE,GJcS,CAAA,CCpBG,IGMH,EAAE,OJcF,GAAiB,ACpB9B,CAAiC,EAAjC,EAMC,0JDcY;AERX,AFYW,AGjBb,ACFsC,GAApC,GFOM,ADXN,CDuBW,CAAA,GEZA,GAAG,CDXL,EDuBE,CCvBF,EDuBc,ACvBd,CAAA,ECWK,CAAA,OAAA,CAAQ,SGhBxB,CHgBgB,EAAoB,WAApB,EAAiC,yZFYpC;AK3Bb,AHgBI,AFeS,AGpBb,ACAE,IFKE,EDXF,AGMM,CJoBK,CAAA,AC1BX,GAAA,AGMW,EHNX,CAAA,AGMc,GJoBH,CEfK,EAAE,AFeK,GIpBT,CFKQ,AELR,CFKS,MELT,CAAQ,SAAR,EAAmB,cAAnB,CAAd,gHJoBW;AK9Bb,AHciD,AFoBpC,AGvBb,AJZA,AKYE,EAAA,CFGc,CAAd,AHfF,EEKE,CD8BW,CAAA,GIvBX,CAAA,GHPS,GD8BE,ADnCb,AEKW,CGOT,CHPS,AGOD,CJuBgB,ADnC1B,IEKW,GFLX,CAAA,AKYE,CHPS,CAAA,AGOU,GHPP,CAAH,GAAI,OFLf,AKYE,CLZF,CKYqC,CLOrC,oGCgBa;AKjCb,ADWI,IAAA,EHPF,EAAA,GAAA,EAAA,AGOW,CHPX,CGOa;AFMb,AEPmC,GAAnC,GFOI,ADbJ,EAAE,ECaM,CAAC,ADbP,EAAA,KAAA,ICaF,CDbE,CCaoB,ADbpB,GAAG,aAAH,GAAgB;AIHpB,AHiBI,ACPJ,AJOA,AKLE,EAAA,EFKE,EDbF,EAAA,CIJc,AFUA,AJOP,EEbP,AGQA,CAAA,CFKE,ADbF,CCaE,ADbF,KFaF,AKLE,CLKkB,AKLV,CFKN,CAAQ,GELV,EFKE,AHAJ,AKLiB,CDFjB,CDOmB,ACPiB,AJOD,EMjBnC,AFUA,CETE,CFkBD,CCPC,EAAwB,SCZ1B,EAEE,AHeE,EAAmC,aGjBvC,EAE0B;AAExB,AHcI,AHAJ,AKLE,IAAA,EFKE,ACPJ,AJOM,AEdN,GGSO,EHTF,AGSI,GLKK,AEdT,CCcQ,ACPJ,CFPJ,CCcU,AHAoB,CIP1B,EAAA,CDOU,ACPV,AFPJ,CCce,EHAsB,CAAC,CEdtC,CAAA,GFc8B,AEd3B,CFcyC,EGDZ,UHCF,CAAnC,EEdK,GAAmB;AICxB,AHcI,AHAJ,AKNW,MCRL,AHcF,ACPJ,AFPA,AGQW,EDDX,AFPA,CFcO,CKNQ,CDDf,AFPA,CCcU,AENO,CDDjB,AFPA,CCcY,ACPZ,AFPA,GFce,GAAG,CMdG,GAAG,INcE,CAAC,CAAD,CAAR,CAAY,CMdxB,MNcY,CAAoB,GAApB,EAAyB,EAAzB,CMdM,ANcT,CMdU,ENcuB,IAAhD,OMdwB,EAAsB;AAAK,AHe7C,AHAP,AKPU,KADe,CDAxB,AFPA,ECeM,GGf6C,GFO3C,GAAA,CFPI,CEOJ,EEP4C,AHejC,ADfP,ECeS,ADfT,CEOJ,CEP2C,EAAc,CJArD,CEOJ,CAAA,GAAG,AFPC,CAAA,CEOJ,EFPO,CEOF,SFPG,CAAD,EAAE;AICf,AHaU,ADdU,AGSpB,ANVJ,IMUI,ANVQ,EKSV,EAAA,GAAA,AFRsB,EICnB,AFOH,ALTF,CKSE,GEPwB,CAAC,AJDI,AGSb,CHTc,CGSZ,EHTI,CAAY,CAAZ,CAAA,KICnB,KAAuC,aAAxC;AAAqD,AHWlB,AHKvC,AEjBsC,AGUhC,GHVQ,EIAuC,AHYjD,CCJF,AFRoC,AGUhC,GLOG,EKPE,EAAE,EDFF,GAAA,EAAA,CCCS,GLQpB,CITW,AJSc,KITd,CAAA,CJSX,EITc,AJSyB,CIT5B,GAAI;AEP0C,AHiBtD,AHAD,AEfA,AGQI,ANZN,CAAA,EOCE,GFSA,AJSM,AEfA,AGQF,EDFJ,ECEQ,CDFR,ALVU,CMYA,CDFV,CAAA,EJSgB,GAAqB,CEfjB,AHJtB,EAAqB,CGII,GFeqB,AKPjC,CLOkC,IKPnC,CLO2B,AEfd,CFe4B,AEf5B,AGQP,OHRO,CACrB,MFcmC,CAArC,EEfuB,EAErB,SAAO,EAAP,GAAS,6CAFY,EAGrB;AFaF,AEZI,AGKE,ANZN,EAAA,EGOI,EEEJ,ECGM,CLOC,EDnBP,CAAA,CGOa,EAAE,CEEL,CCGK,CAAE,CDHP,AJUO,EIVP,CJWN,ADpBJ,CMYsB,ANZtB,CMYuB,EDHb,ALTV,IMYiB,CDHP,ACGyC,CDHzC,GAAG,AJWT,CAAA,ADpBJ,ECoBI,AKRW,CDHL,ACGJ,CLQE,EIXS,EFFuB,KAAzB,CFaX,CAAA,CAAgB,AEbyB,GFazC,CAAoB,UAAA,CAAA,EAAC;AMjBzB,AHiBA,AHA6B,AEd3B,AGOG,ANZL,EAAA,CGEuB,CAAvB,EIAM,AFON,EAAA,CDUO,ECVP,AJU6B,ADnB7B,CCmB8B,ADnB9B,CKSA,AJU+B,CIV/B,MJU6B,CAAU,GMjBf,CNiBK,CDnB7B,COE2B,ANiBkB,ADnB7C,ECmB6B,CAAA,ADnB7B,UOE2B,CAAA,EAAA,CPF3B,COE+B,QAAQ,CAAC,WAAb,CAAA,CACxB,MADwB,CACjB,UAAC,WAAD,EAA2B;AACjC,AHgBF,AHD8C,AEThD,AGFkB,ANPlB,EAAA,CCkBI,CGCF,AHFe,EITjB,AFCM,CFUF,IMhBA,ANcJ,ADjBA,CAAA,EImBY,CCXH,CDWG,ADVI,EEDP,CFCU,CEDV,ALRT,CAAA,GOGI,APHJ,COGI,AFKK,CDUF,CGfH,CJMe,CINX,AJMW,CEDV,CAAA,CLRT,EKQY,EFCO,CAAQ,GINR,CAAC,GFKP,CAAD,CELR,CAAA,AFKkB,CELK,GJMR,CINf,CAA4B,AJMW,eINI,CAAC,aAAD,CAA3C,CAAA,AJMe,CAAnB;AIN+D,AHiB7D,ACZyB,AJY5B,AETC,AGNwB,ANJzB,CAJD,CCyBA,CMrB6B,ADI3B,ANRU,CIuBR,CGfC,CJMG,EIVqB,CAKvB,AHcG,EAAA,ACZoB,CLXR,GGcJ,AHdL,CIqBH,ECV2B,AFGhB,CILb,AFE8B,CEF/B,EAAE,AFEqB,ALXjB,CKW6B,ALX7B,IGcQ,CAAA,IHdR,GGcQ,CAAQ,CHdhB,GKWiB,EAA+B,CAA/B,CAAA,ALXjB,CAAA,CGcQ,EAAoB,MHd5B,GAAS,EAAT,CAAZ,GAMA,oBGQoB,EAAyD;AIJrE,AHcJ,ACb0D,AJe9D,AEXI,AGGF,EAAA,CDPS,CDaP,ADTA,EEJ0D,GFIrD,CCSC,CGdD,AJKE,AGGT,CFMU,AENV,OAAA,CAAQ,ICRD,AClBT,CDkBS,ADQP,ECRO,ADQQ,ECRJ,CAAC,AHcF,CGdG,QAAN,CAAA,ADQP,CCRuB,CDZY,CAsBnC,ECVO,CAAqB,eAAe,CAAC,aAAD,CAApC,EACE,KADH;AACQ,AHaE,AHGlB,AEZY,GIXiB,EASxB,CFDH,AFGU,EEHV,EFGc,CIXa,AFQ3B,CECU,AJEM,CCSA,ACZhB,CAAA,QECW,CAAD,AHWgB,CAAC,CGXf,KHWI,EAAA;AGXC,AHWkB,AI/BrC,ALsBW,AGMT,ANdF,IQdA,CLqB6E,CEF3E,ACSM,GNdQ,EOMI,ECpBpB,GAAA,CF4BmB,EDTJ,CCSsB,EDTtB,CGnBf,CAAA,AHmBe,EECoB,EDQU,CCRP,AFDvB,ACS+B,CCRP,CAAC,CPNxC,CAAwC,CKKzB,CGnBf,AHmBe,CGnBf,EHmBkB,ALLlB,CKKmB,CCSkB,ANdkB,CMcG,CAArB,CDTnB,ACShB,ANdF,EKKyB,ALL0C,COM5B,CAAJ,EFDjB,CECyC,CFD5B,GECZ,EFDD,CAAH,GAAsB;AEC2B,AHQvD,ADLL,AGOF,ANfA,EMeA,CCnB2B,AHiB3B,CGjBA,AJYE,EEHF,EAAA,GAAA,EAAA,AFGW,AGOA,CDVX,ACUY,CHPC,OAAA,CAAA,CGOb,CAAuB,QHToD,4MGS3E;AFGD,AIhCD,APkCA,AEXI,AGiBF,ANzBA,EMyBA,EExCF,ALuBI,EEJF,GJec,IKMH,CAAC,ELNd,CIfa,AJgBX,CEZgB,EEJL,AFIO,EKvBpB,AHmBa,CJeb,CKME,CExCF,APoCE,AKIuB,EDrBZ,KGnBb,AHmBa,AJeb,COlCA,AHmBa,CJkBX,EIlBc,EAAH,AJeb,EAGyB,CIlBP,YGnBlB,CAAA,gCFwCE;ACnBA,ANgBA,AEbI,AGqBJ,AN7BA,EM6BA,ICxBM,AFDN,AJiBA,AEbI,AHRE,EKIN,EJiBA,CIjBA,AFIS,EEJT,AFIW,AGqBA,CCxBG,AFDd,ACyBY,CLRZ,EMhByB,GNgBzB,AEdkB,AHPE,CCqBpB,EAAA,ADrBgC,CM6BhC,CAAuB,GN7Bc,GAAG,CAAxC,CAHiE,CAKjE,COG2C,CAAC,MAA5C,sDDwBA;AFxCF,AIJA,APoCE,AEZI,AG0BJ,ANhCA,EMgCA,EElDF,APoCE,EIjBA,AFKI,CCpBN,CAAA,AHgCE,EEZQ,CFYR,CEZU,CFYV,AKcW,CD/BH,AC+BI,GD/BJ,EGnBV,AHmBU,EDfV,CIJA,EJIA,ACeU,AC+BR,CACE,IEnDJ,AHmBU,AFKmB,CKxB7B,AHmBU,AFKoB,CAAC,CAAF,CELhB,IDfb,ECeU,GAAS,KGnBnB,CAAA,mFFkDE,EAOE,CAPF,EA/CmC,CAyDnC;ACvCA,AFAA,AJeuB,AEdL,MIDd,AFAE,QEAM,EFAI,GEAC,AFAE,CEAnB,EAAoB,CAClB,IFDyB,KAAK,MAAhC;AEEC,ACtBH,AHsBE,AFJ2E,AG0C3E,AN1CA,EM0CA,AN1CA,COEA,AJFkB,CKlBpB,ALkBE,CHAG,CKIG,ELJA,COIC,CFAG,CLJD,EKII,ACsCF,CAAC,AN1CA,GAAG,GAAG,CAAT,CKII,CAAA,CCsCb,AN1CsB,CQlBxB,AF6DI,GE7DJ,CRkB6B,CKId,CAAQ,ELJU,EQlBjC,CAAA,IHsBe,EAAmB,KLJa,GAAG,CKIT,ALJU,CAAJ,GAAQ,CAA1B,CAA3B,CAPiE,CQXnE,AHsBkC,ALHhC,CQnBF,EHsBiD,iBAAlC,EAAqD,cCsClE,EAME,CANF;ACrCE,AFAA,AJeF,AEZA,AG2CA,EAAA,ED9CE,EJeI,AEZA,IEHE,EAAE,CC8CC,CL/BG,AK+BF,GL/Ba,EEZN,GAAG,CEJ4C,CJgBlC,AK+BhC,CL/BiC,AKgC/B,KLhCuB,CAAc,AEZjB,CAAA,OAAA,CAAQ,KFYL,EAA8B,CAA9B,CAAzB,CEZsB,EAAoB,6BAApB,EAAmD,0KG2CzE,EAaE,CAbF;AC7CE,ACvBJ,AHuBI,AJeF,AEZE,AGyDF,AN/DA,EM+DA,EEnFF,AHuBI,AFGA,EFYI,GDlBI,EOGD,ANeE,EEZA,AGyDA,CL7CG,AK6CF,AN/DG,CGMF,EHNE,CQpBjB,AHuBkB,EAAE,CGvBpB,AHwBM,CLJM,ECkBc,AEZF,AGyDtB,CL7CyB,AEZF,AG0DrB,ANhEmB,GQpBvB,ARoBE,COG2B,ACvB7B,CDuB8B,ENeJ,CAAxB,AEZa,KIHuB,GAAG,CAAZ,CAAzB,ECvBJ,CAAA,iOFmFE,EAaE,CAbF;AC3DC,AFAK,AJeN,AEdyE,AGyEzE,AN7ED,EM6EC,CHzEsB,CAAtB,EEDM,AJeA,KIfK,EAAE,AC0EF,CAAC,EL3DI,GAAG,EIff,GC0EJ,CACE,SL5DgC,CAAC,OAAD,CAAlC,8CK2DA,EAIE,CAJF;ACzED,ACRD,AHOyB,AJiBvB,AEZA,AG2EA,EH3EA,AG2EA,EEvFF,EHOyB,AJiBnB,EAAE,EIjBqB,CJiBL,AEZtB,CEL6B,AFK7B,CG2EW,CAAC,GL/DgB,CAAC,CEZ7B,CAAQ,IKZV,AFuFE,CACE,EExFJ,GLYE,CFYsB,CAAqB,AEZvB,EKZtB,CAAA,IPwBwB,CAAtB,iBOxBF,CAAA,QLYE,EAAwD,qBG2ExD,EAIE,CAJF;ADhFI,AFMF,AGgFF,ANpGF,EMoGE,EHhFE,CEPgB,EAEd,ALfN,CAAA,CGoBS,EAAE,EGgFE,CAAC,UAAZ,CACE,MNrGJ,GAAA,uBAAA,yHMoGE,EAME,CANF;AC/GF,ACmBA,AHQQ,AJgBN,AEZU,AGwFX,IEpGD,EHQQ,AJgBF,AEZM,CI/BZ,AN2CO,CM3CP,CN2CE,CEZc,CKZhB,AHQa,AJgBF,CEZO,CEJH,CGRf,OAAA,AHOM,CGPN,QDnBA,CCmBA,CAAA,CDnBA,sBAAA;AF4BQ,AJgBJ,AEbO,AHPX,KGM0D,CEFlD,GLJQ,CKIJ,EAAE,cAAU,CAAV,CLJd,CKIyB,ALHvB,EADF,EAEE,WAFF,EAGE,SAHF,EAGiC;AQPjC,AHSU,AJgBN,AEbA,AGlCJ,AN+BE,IQTF,APyBI,AEbA,EFaE,ADhBA,CM/BN,CAAA,CL+CS,IEbI,EAAE,EFaE,ADhBA,CCgBC,ADhBA,IGGH,CAAA,GGlCf,CN+BE,CQTF,CFtBA,AN+B6B,EQT7B,APyBS,CAAuB,AEf0B,MKV1D,CAAA,CPyBS,CAAL,MK/CJ,kBEsBA,CAAA;AHUU,AFGN,AHHA,IGGA,AHHA,EAAE,CAAC,CKAG,CAAC,CAAC,ELAR,CAAS,KGGK,EAAE,IEHV,CLAN,GAAwB,WAAW,CAAC,SAAZ,CAAsB,QAAtB,EAAxB;AQRS,AHSJ,AJeL,AEZE,AHHH,MGGG,CKZO,CAAA,APwBL,GEZG,EKZE,APwBT,AEZS,EFYE,COxBO,ILWF,EKXgB,CAAC,KAAxB;AA6Bb,AHzBM,AJqBA,AEZA,IKgBK,CH3BS,CFWd,IAAI,EKgBV,ALhBY,iBAAiB,CAAC,CAAD;AEbuC,AJ0B9D,AEfc,AHDlB,GKVa,CAAb,EJ0BI,ADhBA,ECgBE,CAAC,EAAH,GAAQ,GDhBG,CAAC,CCgBZ,MDhBJ,EAAyB;AQmB3B,AHfE,AJaG,AEnBqD,AHGtD,CQkBJ,ELrBE,CHGE,EKGI,ALHF,CAAC,IQkBI,CRlBP,CAAS,IKGM,EGenB,CHdI,CGce,ERlBf,GAAsB,CAAC,EKIvB,CAAA,OAAA,CAAQ,ALJ0B,CAAC,GKInC,EAAc,ELJS,GAAsB,CAAvB,EAA0B,QAA1B,EAAtB,UKIA,EAA4C;AGe9C,AHdI,ALJH,EQkBD,EHdI,KAAK,CGcT,CAAA,AHdW,QGcX,CAAA,UAAA,CAAA,GAAA,CAAA,CAAA,GAAA,UAAA;AACA,AHdM,AJYJ,AEZF,EKcA,IHdM,EJYA,EOEN,AHdU,CGcV,ALdS,CEAG,MJYV,COEF,CAAA,AHfW,AJaO,GEZlB,CAAsB,SAAtB,EKcA,ALduC,CKcvC,GAAA,CAAA,CAAA,GAAA,eAAA;AACA,AHdM,AJYF,AEZF,AHLF,EQmBA,ELdE,EEAI,AJYF,ADjBA,GKKK,CGcT,CAAA,AHdW,CAFA,IJcG,CAAC,AEZA,AHLA,CGKC,AHLA,CQmBhB,CAAA,IPFI,CAAmB,EEZrB,AHLF,EAA2B,CGKC,EKc5B,CAAA,EPFwB,COExB,APFuB,COEvB,CAAA,APFyB,CEZY,CAAC,CKctC,OLd4B,EAA1B,GKcF;AACD,AHdO,AJWwB,ADhB5B,CQeJ,EAAW,CRfP,EKKI,ALLF,CAAC,IQeY,AHVN,CLLT,CKKW,ALLF,ECgBmB,CODrB,CPCuB,CAAC,IIdtB,EGaM,GAAA,APCa,CAAa,ADhBzC,CQee,CAAnB,CPCgC,ADhBD,CCgBkB,CAAjB,CAAA,QDhBU,CAAC,SAAZ,CAAsB,QAAtB,EAA3B;AKMI,AJU2C,AEV/C,AHLD,MKKK,CJUF,CEVE,EEAI,EAAE,CAJD,IFII,KAAK,CAAlB,EAAqB;AKczB,AHbQ,AJUH,AEVC,MKaA,ALbA,CKaC,MAAP,ELbe,CKaC,ALbA,GEAK,MFAf,CAAoB,EKaV,CLbV,CAAwB,UAAxB;AKcJ,AHnBW,AFMR,AHNH,KGIE,CHJE,KGMK,MHNM,CAAC,OAAhB,EAAyB;AQoBzB,AHrB8C,AJkB5C,AEVE,AHNF,GKFA,CADF,ALGE,EGME,AHNA,CAAC,CCgBC,IAAI,ADhBR,CCgBS,ADhBA,EGME,CAAC,EFUZ,EAAgB,KEVd,CAAoB,AHNtB,GAAyB,CAAC,EGMxB,CAA2B,QHNQ,CAAC,CGMpC,MHNwB,GAAsB,CAAvB,EAA0B,QAA1B,EAAzB;AQoBF,AHXA,AJQI,AEVD,AHNF,MQmBK,AHXA,AJQF,MAAM,CAAC,MOGQ,AHXA,AJQf,CAAc,EOGI,AHVpB,AJOE,EAAkB,IAAI,CAAC,EIPzB,CAAA,EJOE,KIPF,CAAQ,IAAR,EAAc,8BAAd,EAA8C;AGUxB,AHTpB,AJOD,AEVF,IKYuB,AHTpB,IGSwB,CHTnB,CGSqB,CHTnB,CGSW;AAAY,AHTrB,ALRb,EAAA,EQiBkC,ARjBhC,CAAC,CKQU,EGSyB,EAAE,AHTvB,ALRjB,CAAS,CKQU,MLRnB,GAAmB,OAAnB,CAf+B,CAeH;AQiBN,AHTX,AJST,AEXF,AHLD,GQgBC,CAHc,APGZ,COCF,KPDQ,CAAC,AEXA,WFWP,CAAmB,EAAnB,GEXF,CAA2B,MAA3B,EAAiC;AECe,AJW/C,AEXC,GEAA,CADF,OFCS,YAAA;AKYT,AHPA,AFJI,AH1BN,MQqCM,AHPE,CL9BR,CAAA,EG0BY,GEIG,GAAG,GGOC,ALXE,GKWC,ALXE,CAAC,CKWvB,CALc,AHFE,CGShB,AHTgB,CL9BlB,GAAA,GK8BkB,CAAQ,EFJY,CAAC,CEIrB,EAAc,MFJR,GAA2B,AH1BnD,EAqBA,IGKM,aEIY,EAA4C;AGU5D,AHTE,AJOF,AEVI,AHNN,IKSI,EJOE,AEVA,IFUI,CAAC,EIPE,EAAE,GFHG,CAAC,IEGI,EJOrB,EAAyB,CIPC,AFHV,CAAZ,EEGS,GAAmB,OAAA,CAAA,kBAAnB,GAAwC,OAAA,CAAA;AGUrD,AHX4D,AJS1D,AEVE,GECY,CAAhB,AJSE,CI5CH,CAuCC,AFLI,YFUF,AEVc,CFUd,AEVe,QFUf,CAAS,AEVK,CAAZ,GFUW,CAAC,cAAd,EAA8B,OAA9B,CACE,UAAC,QAAD,EAAS;AILb,AJKkB,AEVf,AHPL,KGEI,IHFY,ICiBK,EAAE,CAAC,OAAO,ODjB/B,CCiBuC,ADjBD,CCiBE,GDjBxC,ECiBuB,ADjBkC,CCiBpC,GAA4B,QAAQ,CAAC,IAAtC;AOElB,AHNA,AJI6D,AET5D,AHPD,KCeE,COGI,GRlBC,MAAM,CAAC,CQkBG,GAAgB,ARlBpB,EAAO,GAAP,CAAb,EQkByC,CAAC,aAAT,CAAuB,YAAvB,CAAjC;AAEA,APFC,ADjBF,MQmBO,cAAc,GAAgB,QAAQ,CAAC,aAAT,CAClC,sBADkC,CAApC;AAIA,AHXA,AFJA,EEIA,IGWM,GLfC,EEIP,CAAA,OGWmB,AHXnB,CAAQ,CFJR,CKeqC,KHXrC,EAAiB,kCAAjB,EAAqD;AGYnD,AHXA,AJMF,AEVD,AHXD,IQ0BI,AHXA,EJME,CDrBN,CAAA,CKeS,CJMC,CINC,AJMA,COKC,EAAE,GPLZ,EAAiB,UDrBnB,GQ0Bc,AR1Bd,CQ0Bc,gBAAA,CAAiB,GR1B/B;AQ2BM,AHZO,AJOT,IAAA,EOKE,AHZO,IJOH,CAAC,IOKI,AHZO,EGYL,AHZO,AJOpB,CAAc,EAAE,CAAC,KAAjB,EAAwB,GOIG,CPJC,CAAC,MAA7B;AOME,AHbK,AJQR,AEtEH,AHmDA,KKUuD,CGcjD,CL3EN,CK2EQ,AL3ER,CHmDgB,CQwBN,KRxBV,CACE,IQqB6B,ILzE/B,EHmDA,CGnDA,CHqDE,aAFF,EGnDA,AHqD6B;AQuBvB,AHbF,ALVF,IKUE,EGaE,ARvBJ,SQuBa,EAAE,CAHc,AHVb,CLVhB,CKUkB,CACd,GLXJ,KAAA,CAAA,EAAA;AQwBI,AHZE,AJON,ADnBA,IAAA,EQwBI,AHZE,AJOF,IAAI,COKC,AHZE,AJOF,EOKE,AHZE,ILZb,GCmBA,ADnBA,ECmBoB,CDnBpB,CKWI,KGSyB;AAKzB,AHZE,AJOJ,ADpByB,ICoBzB,EOKE,AHZE,AJOF,CAAC,GIPK,EAAE,IJOV,EOKc,CPLC,COKC,GPLG,CAAC,EIPA,KAAV,EAAe,AJOzB,SOKiB,CAAD,EAAE;AAAK,AHXjB,AJOP,aIPY,EGWY,KHXjB,CAAa,QAAb,GAAwB,MGWgB,CAAC,IHXN,CAAC,CGWI,EAAS,CAAT,CAAvB,AHXjB;AGWmD,AHVnD,ALbR,SAAO,IKaM,MLbI,CKaT,ALbU,CKaG,KAAb,ALbD,CACL,EKY2B,KAAK,CAAC,ELZhC,MKY+B,CAA1B,ELZN,EAAY,OAAZ,EAAqB,CAArB,EAAsB;AQiBK,AHJtB,AJOP,ADnBI,KQgBQ,CADyB,APIjC,IAAI,CAAC,ADnBL,SAAS,CCmBb,EAAqB,CDnBJ,CAAC,GAAG,CAAJ,GAAQ,aAAR,GAAwB,EAA5B,CAAT,GAA2C,OAA3C;AQuBF,AHhBE,AJaF,ADpBoD,GAF/C,CQyBL,APHA,CIdgB,ALLhB,EKaE,ALhBG,CAAP,ECsBQ,CAAC,COGC,EAAE,GPHV,CAAc,EAAE,CAAC,OAAjB,EAA0B,EOGhB,CAAA,CPHoB,CAAC,UAA/B,IOGU,CAAiB;AACzB,AHTE,AJML,ADlBF,MQqBK,AHTE,KAAK,EAAE,EGSA,EAAE,EHVX,YGSyB;AAEzB,AHTE,MGSF,AHTE,EGSA,EAAE,AHTE,EAAE,QGOiB,MHPP,KAAV,EAAe;AGUvB,AHTI,AJMR,AD7BF,MQgCM,APHA,CD7BN,CAAA,EC6BU,CAAC,CINK,ELvBhB,CQgCe,EAAE,ARhCjB,CQ6B+B,CPA7B,CINsB,CJMH,EINM,ALvB3B,KKuBgC,CAAC,QAAD,CAAtB,CADmB,CAEnB;AGSJ,APHF,IAAA,EOGE,KAAK,EAAE,KPHT,CAAA,UOD2B,SPC3B,CAAoB,EAApB,EAAwB,IAAI,CAAC,QAA7B;AOIE,AHTI,AJMP,ADpBH,MQuBM,GRvBU,GKcF,MGSI,ARvBlB,EQuBoB,AHTE,CLdG,IKcE,CAAjB,EAAoB,cGST,CAAD,EAAE;AAAK,AHRjB,ALfgB,MAAA,MKeV,GGQW,MHRF,ELfC,CKeE,ELfF,EKeM,ALfN,CKeO,GAAL,CAChB,CADgB,EAEhB,CAAC,CGMqC,CAAC,GHNjC,GGMgC,EAAS,CAAT,CAAvB,AHNd,CAAa,QAAd,IAA0B,KAAK,CAAC,QAAD,CAAL,GAAkB,KAAK,OAAL,CAAa,KAAzD,CAFgB,CAAlB;AGQmD,AHJnD,AJGR,QIHQ,CJGD,EAAP,QIHmB,CAAC,KAAZ,GAAoB,SAAS,CAAC,QAAV,EAApB;AGDqB,AHErB,AJGT,KOLa,CARyB,CRVb,CKoBhB,GLpBgB,EAAA,GAAA,CKoBP,CAAC,CLpBM,EAAA,GAAA,OKoBO,EAAd,ALpBO,CKoBhB,ALpBgB,QAAA,EAAA,IAA8B;AQyBpD,AHJK,ALrBiB,IQyBtB,ARzBsB,GQyBnB,EAAE,YRzBiB,CAAA,EAAA,CAAA,GAAA,EQyBjB,CAAA,MRzBiB,CAAA,EAAA,CAAA,SQyBjB,CAAoB;AACvB,AHjBA,AJvCN,KI+BoB,CGyBd,CPxDN,CAAA,OOwDe,APxDf,EOwDiB,CPxDjB,OAAA,COwDiB,CAAA,APDjB,OOCiB,CACT,cADS,EAET,qDAFS,EAGT;AACE,AH/B6C,GAArD,KG+BQ,SAAS,EAAE;AADb,AHHN,AJAF,ADzBE,EKyBA,KGAe,CADY,CPCb,ADzBP,MKyBM,ALzBA,CKyBC,ALzBA,OKyBd,CAAsB,AJAxB,CAAgC,QDzBjB,CKyBmB,CLzBC,GCyBnC,CDzBe,CCyBmD,ADzBhE,GKyBsB,EAAmB;AGOrC,AHNF,AJAF,ADzBD,ECyBC,IOMI,EHNI,MGMI,CPNC,COMC,APNA,GIAK,GACf,CJDJ,CAAsB,OIClB,CAAA,EJDmB,COFI,APEL,EAAE,EICpB,CAAQ,aAAR,EAAuB,YAAU,SAAjC,EAA8C;AGM9C,AHLE,AJFuB,MOOzB,AHLE,KAAK,AJFkB,CAAC,CIEjB,AJFkB,EOOlB,EAAE,EPPc,EAAA,eOOb,CAAD,EAAE;AAAK,AHLP,AJFwB,AD3BzC,GC2BE,ID3BF,CK6BiB,AL7BjB,KK6BsB,EGKE,AHLA,EL7BxB,GAAA,MQkCmC,CAAC,ERlCpC;AQkCsC,AHLvB,AJDd,OIAmD,GGMd,GAAG,EAAE;AAAP,AHJ5B,AL1BR,MK0BQ,GGI2B,AR9BnB,CQ8BQ,KHJP,EAAE,CL1BnB,GAAyB;AQ8BsB,AHNK,AJFpD,ADtB0B,KKwBpB,CADF,ALvBsB,CQqBG,APC7B,CAAA,eAAA,ADtB0B,GCsB1B,ADtB0B,EAAA,aCsB1B;AOSM,MAAA,aAAa,EAAE,CAAC,IAAD,EAAO,KAAP;AAVQ,AHSzB,KGTK,ERrBiB,CK8BlB,GL9BkB,EAAA,GAAA,CK8BT,EL9BS,EAAA,CK8BJ,EL9BI,QK8BtB,CL9BsB,CK8BQ,AL9BR,QAAA,EAAA,IAA8B;AQMjB,AHyBjC,AL/BoB,GQMxB,CRNwB,EK+BpB,WAAW,CAAC,GL/BQ,CAAA,EAAA,CAAA,CK+BpB,EL/BoB,CK+BG,IAAvB,IL/BoB,CAAA,EAAA,CAAA;AKgCrB;AGGH,AHFC,GAXD,QGaS,uBAAT,CAAiC,GAAjC,EAAsC,SAAtC,EAA+C;ARlC/C,SAAO,MAAM,CAAC,iBAAD,EAAoB,GAApB,CAAb;AKiCA,ALhCD,WKgCU,aAAT,GAAsB;AGEpB,AHDA,QGCM,GHDC,KAAG,IGCQ,GAChB,GAAG,CHFgB,CAAC,GGEZ,EHFH,GAAuB,CGE5B,GAAiB,SHFwB,CAAC,KAA5C,CGEmC,EAAjC,GAAsC,gBAAgB,EADxD;AHAD,ALpCH,OAAA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","file":"index.js","sourceRoot":"..","sourcesContent":["import { Grid_Pos } from \"./index\";\n// Functions related to grid construction\n\nexport interface XY_Pos {\n  x: number;\n  y: number;\n}\n\nexport enum Drag_Type {\n  top_left = \"top-left\",\n  bottom_right = \"bottom-right\",\n  center = \"center\",\n}\n\n// Builds the start/end css string for a grid-{row,column}\nexport function make_template_start_end(start: number, end?: number): string {\n  // If we only have a single value just assume we take up one row\n  // If single index is a negative one, we need to subtract instead of add to it\n  const negative_index: boolean = start < 0;\n\n  // Grid works with lines so if we want an element to end at the 4th column we\n  // need to tell it to end at the (4+1)5th line, so we add one\n  end = end ? end + 1 : start + (negative_index ? -1 : 1);\n  // end = end ? +end + 1 : start + (negative_index ? -1 : 1);\n\n  return `${start} / ${end}`;\n}\n\nexport function set_element_in_grid(\n  el: HTMLElement,\n  grid_bounds: Grid_Pos,\n  el_styles?: CSSStyleDeclaration\n) {\n  if (grid_bounds.start_row) {\n    el.style.gridRowStart = grid_bounds.start_row.toString();\n  }\n  if (grid_bounds.end_row) {\n    el.style.gridRowEnd = (grid_bounds.end_row + 1).toString();\n  }\n  if (grid_bounds.start_col) {\n    el.style.gridColumnStart = grid_bounds.start_col.toString();\n  }\n  if (grid_bounds.end_col) {\n    el.style.gridColumnEnd = (grid_bounds.end_col + 1).toString();\n  }\n\n  el.style.display = \"block\"; // make sure we can see the element\n}\n\n// grid-template-{column,row}: ...\n// Take a vector of css sizes and turn into the format for the css argument for\nexport function sizes_to_template_def(defs: Array<string>) {\n  return concat(defs, \" \");\n}\n\nexport function concat(\n  string_vec: Array<string>,\n  collapse_char: string = \" \"\n): string {\n  return string_vec.reduce(\n    (concatted, current, i) =>\n      concatted + (i > 0 ? collapse_char : \"\") + current,\n    \"\"\n  );\n}\n\nexport function concat_nl(...component_strings: string[]) {\n  return concat(component_strings, \"\\n\");\n}\n\nexport function concat_sp(...component_strings: string[]) {\n  return concat(component_strings, \" \");\n}\n\nexport function as_array<T>(content: T | Array<T>): Array<T> {\n  if (content instanceof Array) {\n    return content;\n  } else {\n    return [content];\n  }\n}\n\n// Passing an undefined value to a compare like min or max will always give undefined\n// These functions let you default to the second option in the case the first is falsy\nexport function compare_w_missing(\n  compare_fn: (...values: number[]) => number,\n  maybe_a: number | null,\n  b: number\n) {\n  return maybe_a ? compare_fn(maybe_a, b) : b;\n}\nexport function min_w_missing(maybe_a: number | null, b: number) {\n  return compare_w_missing(Math.min, maybe_a, b);\n}\nexport function max_w_missing(maybe_a: number | null, b: number) {\n  return compare_w_missing(Math.max, maybe_a, b);\n}\n\nexport interface Selection_Rect {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n}\n\n// Produce bounding rectangle relative to parent of any element\nexport function get_bounding_rect(el: HTMLElement): Selection_Rect | null {\n  if (el.offsetParent === null) {\n    return null;\n  }\n  const top = el.offsetTop;\n  const left = el.offsetLeft;\n  const height = el.offsetHeight;\n  const width = el.offsetWidth;\n  return { left: left, right: left + width, top: top, bottom: top + height };\n}\n\nexport function boxes_overlap(\n  box_a: Selection_Rect,\n  box_b: Selection_Rect\n): boolean {\n  const horizontal_overlap = intervals_overlap(\n    [box_a.left, box_a.right],\n    [box_b.left, box_b.right]\n  );\n  const vertical_overlap = intervals_overlap(\n    [box_a.top, box_a.bottom],\n    [box_b.top, box_b.bottom]\n  );\n\n  return horizontal_overlap && vertical_overlap;\n\n  // Figure out of two intervals overlap eachother\n  function intervals_overlap([a_start, a_end], [b_start, b_end]) {\n    //   aaaaaaaaaa\n    // bbbbbb\n    //         bbbbbb\n    const a_contains_b_endpoint =\n      (a_start >= b_start && a_start <= b_end) ||\n      (a_end >= b_start && a_end <= b_end);\n\n    //   aaaaaa\n    // bbbbbbbbbb\n    const b_covers_a = a_start <= b_start && a_end >= b_end;\n\n    return a_contains_b_endpoint || b_covers_a;\n  }\n}\n\nexport function update_rect_with_delta(\n  rect: Selection_Rect,\n  delta: XY_Pos,\n  dir: Drag_Type\n): Selection_Rect {\n  // Need to destructure down to numbers to avoid copy\n  const new_rect: Selection_Rect = { ...rect };\n\n  // The bounding here means that we dont let the user drag the box \"inside-out\"\n  if (dir === Drag_Type.top_left) {\n    new_rect.left = new_rect.left + delta.x;\n    new_rect.top = new_rect.top + delta.y;\n  } else if (dir === Drag_Type.bottom_right) {\n    (new_rect.right = new_rect.right + delta.x), new_rect.left;\n    (new_rect.bottom = new_rect.bottom + delta.y), new_rect.top;\n  } else {\n    // Just move the box\n    new_rect.left += delta.x;\n    new_rect.top += delta.y;\n    new_rect.right += delta.x;\n    new_rect.bottom += delta.y;\n  }\n\n  // Make sure positions are proper for bounding box (in case box was flipped inside out)\n  if (new_rect.left > new_rect.right) {\n    const { left, right } = new_rect;\n    new_rect.right = left;\n    new_rect.left = right;\n  }\n  if (new_rect.top > new_rect.bottom) {\n    const { top, bottom } = new_rect;\n    new_rect.bottom = top;\n    new_rect.top = bottom;\n  }\n\n  return new_rect;\n}\n\nexport function get_css_unit(css_size: string): string {\n  return css_size.match(/[^ \\d | \\.]+$/g)[0] || \"px\";\n}\n\nexport function get_css_value(css_size: string): number {\n  return Number(css_size.match(/^[\\d | \\.]+/g)[0]);\n}\n\n\n","import { Grid_Pos } from \".\";\nimport {\n  as_array,\n  set_element_in_grid,\n} from \"./misc-helpers\";\n\nexport interface Event_Listener {\n  event: string;\n  func: (event: Event) => void;\n}\n\ninterface Element_Opts {\n  event_listener?: Event_Listener | Array<Event_Listener>;\n  styles?: object;\n  innerHTML?: string;\n  data_props?: object;\n  grid_pos?: Grid_Pos;\n  props?: object;\n}\n\n// Safari doesn't support lookbehinds for regex so we have to make it manually\nfunction extract_id(sel_txt: string): string|null {\n  const id_match: RegExpMatchArray = sel_txt.match(/#([^\\.]+)/g);\n  return id_match ? id_match[0].replace(\"#\", \"\"): null;\n}\n\nfunction extract_classes(sel_txt:string): Array<string>|null {\n  const class_list: RegExpMatchArray = sel_txt.match(/\\.([^\\.#]+)/g);\n  return class_list \n    ? [...class_list].map(c => c.replace(\"\\.\", \"\"))\n    : null;\n}\n\n// This is a heavy-lifter that takes care of building elements and placing them\n// on the grid etc.. It only create's an element if it needs to, which means\n// that we dont get dom leaks caused by recalling stuff over and over again.\nexport function make_el(\n  parent: HTMLElement,\n  sel_txt: string,\n  opts: Element_Opts = {}\n  ) {  \n\n  const tag_type: string = sel_txt.match(/^([^#\\.]+)+/g)[0];\n  const el_id = extract_id(sel_txt);\n  const class_list = extract_classes(sel_txt);\n\n  let el: HTMLElement = parent.querySelector(sel_txt);\n  if (!el) {\n    // Element doesn't exists so we need to make it\n    el = document.createElement(tag_type);\n    if (el_id) {\n      // debugger;\n      el.id = el_id;\n    }\n\n    if (class_list) {\n      class_list.forEach((x) => el.classList.add(x));\n    }\n\n    if (opts.props) {\n      Object.assign(el, opts.props);\n    }\n\n    parent.appendChild(el);\n  }\n\n  if (opts.event_listener) {\n    as_array(opts.event_listener).forEach(\n      (listener) => (el[\"on\" + listener.event] = listener.func)\n    );\n  }\n\n  if (opts.styles) {\n    Object.assign(el.style, opts.styles);\n  }\n\n  if (opts.innerHTML) {\n    el.innerHTML = opts.innerHTML;\n  }\n\n  if (opts.data_props) {\n    Object.assign(el.dataset, opts.data_props);\n  }\n\n  if (opts.grid_pos) {\n    set_element_in_grid(el, opts.grid_pos);\n  }\n\n  return el;\n}\n\n// Given a list of elements from a query selector, remove them all\nexport function remove_elements(els_to_remove: NodeListOf<Element>): void {\n  els_to_remove.forEach((e) => e.remove());\n}\n","export const vertical_drag_icon = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M21 11H3V9H21V11M21 13H3V15H21V13Z\" />\n</svg>`;\n\nexport const horizontal_drag_icon = `<svg style=\"width:24px;height:24px;max-height:100%;\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M11 21H9V3H11V21M15 3H13V21H15V3Z\" />\n</svg>`;\n\nexport const trashcan_icon = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z\" />\n</svg>`;\n\nexport const bottom_right_arrow = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M5,6.41L6.41,5L17,15.59V9H19V19H9V17H15.59L5,6.41Z\" />\n</svg>`;\n\nexport const se_arrow = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M5,6.41L6.41,5L17,15.59V9H19V19H9V17H15.59L5,6.41Z\" />\n</svg>`;\n\nexport const nw_arrow = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M19,17.59L17.59,19L7,8.41V15H5V5H15V7H8.41L19,17.59Z\" />\n</svg>`;\n\nexport const top_left_arrow = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M5,6.41L6.41,5L17,15.59V9H19V19H9V17H15.59L5,6.41Z\" />\n</svg>`;\n\nexport const drag_icon = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M22.67,12L18.18,16.5L15.67,14L17.65,12L15.67,10.04L18.18,7.53L22.67,12M12,1.33L16.47,5.82L13.96,8.33L12,6.35L10,8.33L7.5,5.82L12,1.33M12,22.67L7.53,18.18L10.04,15.67L12,17.65L14,15.67L16.5,18.18L12,22.67M1.33,12L5.82,7.5L8.33,10L6.35,12L8.33,13.96L5.82,16.47L1.33,12M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10Z\" />\n</svg>`;\n\nexport const plus_icon = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z\" />\n</svg>`;\n\nexport const minus_icon = `<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n<path fill=\"currentColor\" d=\"M19,13H5V11H19V13Z\" />\n</svg>`;","import { minus_icon, plus_icon } from \"./icons\";\nimport { make_el } from \"./make_el\";\n\n// Builds an up down button and value input\nexport function make_incrementer({\n  parent_el,\n  start_val = 2,\n  id = \"incrementer\",\n  label = \"my incrementer\",\n  on_increment = (x) => console.log(x),\n}): (new_value: number) => void {\n\n  const plus_minus_div = make_el(\n    parent_el,\n    `div#${id}_incrementer.plus-minus-input.settings-grid`,\n    {\n      innerHTML: `<span class = \"label\">${label}</span>`,\n    }\n  );\n\n  const inputs_div = make_el(plus_minus_div, \"div.plus-minus-input-controls\");\n\n  const minus_btn = make_el(inputs_div, \"button.plus-minus-input-btn.minus\", {\n    props: {name: \"plus button\"},\n    innerHTML: minus_icon,\n    event_listener: {\n      event: \"click\",\n      func: increment_counter(-1),\n    },\n  });\n  const current_value = make_el(inputs_div, \"span.plus-minus-input-value\", {\n    innerHTML: start_val.toString(),\n  });\n\n  make_el(inputs_div, \"button.plus-minus-input-btn.plus\", {\n    props: {name: \"minus button\"},\n    innerHTML: plus_icon,\n    event_listener: {\n      event: \"click\",\n      func: increment_counter(1),\n    },\n  });\n\n  function update_value(new_value: number) {\n    current_value.innerHTML = new_value.toString();\n\n    if (new_value === 1) {\n      minus_btn.classList.add(\"disabled\");\n    } else {\n      minus_btn.classList.remove(\"disabled\");\n    }\n  }\n  function increment_counter(amount) {\n    return function () {\n      const new_value = +current_value.innerHTML + amount;\n\n      update_value(new_value);\n      on_increment(new_value);\n    };\n  }\n\n  return update_value;\n}\n","import { make_el, Event_Listener } from \"./make_el\";\n\ninterface Modal_Options {\n  background_callbacks?: Event_Listener | Array<Event_Listener>;\n  modal_callbacks?: Event_Listener | Array<Event_Listener>;\n  header_text?: string;\n}\nexport function focused_modal(opts: Modal_Options) {\n  const background = make_el(\n    document.querySelector(\"body\"),\n    \"div.background-blurrer\",\n    {\n      event_listener: opts.background_callbacks,\n    }\n  );\n\n  const modal = make_el(background, \"div.modal\", {\n    event_listener: opts.modal_callbacks,\n  });\n\n  if (opts.header_text) {\n    make_el(modal, \"div.modal_header\", {\n      innerHTML: opts.header_text,\n      styles: {\n        paddingBottom: \"1rem\",\n      },\n    });\n  }\n\n  return {\n    background,\n    modal,\n    remove: () => background.remove(),\n  };\n}\n","import { horizontal_drag_icon, vertical_drag_icon } from \"./icons\";\nimport { make_el } from \"./make_el\";\nimport { get_css_value, get_css_unit } from \"./misc-helpers\";\n\nexport interface CSS_Input {\n  form: HTMLElement;\n  current_value: () => string;\n  update_value: (new_value: string) => void;\n}\n// =============================================================================\n// From here on are a series of general purpose helper functions not\n// specifically related to the app and its state\n// Input with value text box on left and unit selector dropdown on right\n// Used to make valid css sizes\nexport function make_css_unit_input({\n  parent_el,\n  selector = \"\",\n  start_val = 1,\n  start_unit = \"fr\",\n  on_change = (x: string) => console.log(\"css unit change\", x),\n  allowed_units = [\"fr\", \"px\", \"rem\"],\n  form_styles = {},\n  drag_dir = \"none\",\n}): CSS_Input {\n  const allow_drag = drag_dir !== \"none\";\n\n  const form = make_el(parent_el, `form${selector}.css-unit-input`, {\n    styles: form_styles,\n    event_listener: [\n      { event: \"change\", func: on_update },\n      {\n        event: \"submit\",\n        func: function (e) {\n          // Needed to stop pressing enter causing page to refresh\n          e.preventDefault();\n        },\n      },\n    ],\n  });\n\n  const value_input = <HTMLInputElement>(\n    make_el(form, \"input.css-unit-input-value\", {\n      props: {\n        type: \"number\",\n        min: 0,\n        value: start_val,\n        step: 1,\n        \"aria-live\": \"polite\",\n      },\n    })\n  );\n\n  const unit_selector = <HTMLSelectElement>(\n    make_el(form, \"select.css-unit-input-select\", {\n      props: { name: \"units\" },\n    })\n  );\n\n  const resizer = make_el(form, \"div.css-unit-input-dragger\", {\n    innerHTML: drag_dir === \"y\" ? vertical_drag_icon : horizontal_drag_icon,\n  });\n\n  // Place an invisible div over the main one that we let be dragged. This means\n  // we can use the nice drag interaction callbacks without the ugly default\n  // drag behavior of two copies of the div and zooming back to the start pos etc.\n  make_el(resizer, \"div.css-unit-input-drag-detector\", {\n    props: { draggable: true },\n    event_listener: [\n      {\n        event: \"dragstart\",\n        func: function (event) {\n          this.dataset.baseline = value_input.value;\n          this.dataset.start = event[drag_dir];\n        },\n      },\n      {\n        event: \"drag\",\n        func: function (event) {\n          const drag_pos = event[drag_dir];\n          // At the end of the drag we get a drag event with 0 values that throws stuff off\n          if (drag_pos === 0) return;\n          const new_value = Math.max(\n            0,\n            +this.dataset.baseline + (event[drag_dir] - this.dataset.start)\n          );\n          value_input.value = new_value.toString();\n          on_change(current_value());\n        },\n      },\n    ],\n  });\n\n  allowed_units.forEach(function (unit_type) {\n    const unit_option = <HTMLOptionElement>(\n      make_el(unit_selector, `option.${unit_type}`, {\n        props: { value: unit_type },\n        innerHTML: unit_type,\n      })\n    );\n\n    if (unit_type === start_unit) {\n      unit_option.selected = true;\n    }\n  });\n  function current_value() {\n    return `${value_input.value}${unit_selector.value}`;\n  }\n  function on_update() {\n    const val = current_value();\n    update_value(val);\n    on_change(val);\n  }\n\n  function update_value(new_value: string) {\n    value_input.value = get_css_value(new_value).toString();\n    const new_unit = get_css_unit(new_value);\n\n    for (let opt of unit_selector.children as HTMLCollectionOf<\n      HTMLOptionElement\n    >) {\n      opt.selected = opt.value === new_unit;\n    }\n\n    if (new_unit === \"px\" && allow_drag) {\n      form.classList.add(\"with-drag\");\n    } else {\n      form.classList.remove(\"with-drag\");\n    }\n  }\n\n  update_value(`${start_val}${start_unit}`);\n\n  return { form, current_value, update_value };\n}\n","import { make_el } from \"./make_el\";\n\nexport function make_toggle_switch(\n  parent: HTMLElement,\n  off_text: string,\n  on_text: string,\n  on_change: (is_on: boolean) => void\n) {\n  const container = make_el(parent, \"div.toggle-switch\");\n  make_el(container, \"span.off-text\", {\n    innerHTML: off_text,\n  });\n  const label = make_el(container, \"label.switch\");\n  make_el(container, \"span.on-text\", {\n    innerHTML: on_text,\n  });\n  make_el(label, \"input\", {\n    props: { type: \"checkbox\" },\n    event_listener: {\n      event: \"change\",\n      func: (event) => {\n        on_change((event.target as HTMLInputElement).checked);\n      },\n    },\n  });\n\n  make_el(label, \"span.slider\");\n\n  // Add styles\n  const style_sheet: CSSStyleSheet = document.styleSheets[0];\n\n  style_sheet.insertRule(`\n    div.toggle-switch {\n      display: inline-grid;\n      grid-template-columns: 1fr auto 1fr;\n      grid-gap: 3px;\n      width: 180px;\n      align-items: center;\n      justify-items: center;\n    }\n  `);\n\n  style_sheet.insertRule(`\n  .toggle-switch > span {\n    font-size: 0.85rem;\n  }\n`);\n  style_sheet.insertRule(`\n    .toggle-switch > .off-text {\n      text-align: end;\n    }\n  `);\n\n  style_sheet.insertRule(\n    `.switch {\n    position: relative;\n    display: inline-block;\n    width: 60px;\n    height: 34px;\n  }`,\n    0\n  );\n\n  // Hide default HTML checkbox\n  style_sheet.insertRule(\n    `.switch input {\n    opacity: 0;\n    width: 0;\n    height: 0;\n  }`,\n    0\n  );\n\n  style_sheet.insertRule(\n    `.slider {\n    position: absolute;\n    cursor: pointer;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    border-radius: 34px;\n    background-color: #ccc;\n    -webkit-transition: .4s;\n    transition: .4s;\n  }`,\n    0\n  );\n  style_sheet.insertRule(\n    `.slider:before {\n    position: absolute;\n    content: \"\";\n    height: 26px;\n    width: 26px;\n    left: 4px;\n    bottom: 4px;\n    border-radius: 50%;\n    background-color: white;\n    -webkit-transition: .4s;\n    transition: .4s;\n  }`,\n    0\n  );\n  style_sheet.insertRule(\n    `input:checked + .slider {\n    background-color: #2196F3;\n  }`,\n    0\n  );\n  style_sheet.insertRule(\n    `input:focus + .slider {\n    box-shadow: 0 0 1px #2196F3;\n  }`,\n    0\n  );\n  style_sheet.insertRule(\n    `input:checked + .slider:before {\n    -webkit-transform: translateX(26px);\n    -ms-transform: translateX(26px);\n    transform: translateX(26px);\n  }`,\n    0\n  );\n}\n","// Assumes that only one stylesheet has rules for the given selector and\n// that only one rule targeting that selector alone is defined\n// If target_property is provided the function will chose the sheet that defines\n// that given property (if multiple exist)\nexport function find_rules_by_selector(\n  selector_text: string,\n  target_property?: string\n) {\n  // Find the stylesheet which contains the containers styles\n  const defines_ruleset = (selector_text: string) => (rule: CSSRule) =>\n    (rule as CSSStyleRule).selectorText === selector_text;\n\n  const rules_for_selector = [...document.styleSheets]\n    .filter((style_sheet: CSSStyleSheet) =>\n      [...style_sheet.rules].find(defines_ruleset(selector_text))\n    )\n    .map(\n      (x) =>\n        ([...x.cssRules].find(defines_ruleset(selector_text)) as CSSStyleRule)\n          .style\n    )\n    .filter((x) => (target_property ? x[target_property] : true));\n\n  const n_sheets: number = rules_for_selector.length;\n  if (n_sheets === 0) {\n    // No rules declared so make a new rule and append to last style sheet\n  } else {\n    // Take the latest style sheet and (hope) that's the correct one\n    return rules_for_selector[n_sheets - 1];\n  }\n}\n","// JS entry point\nimport { Event_Listener, make_el, remove_elements } from \"./make_el\";\nimport { make_incrementer } from \"./make_incrementer\";\nimport { focused_modal } from \"./focused_modal\";\nimport { make_css_unit_input, CSS_Input } from \"./make_css_unit_input\";\nimport {\n  make_template_start_end,\n  sizes_to_template_def,\n  set_element_in_grid,\n  concat_nl,\n  as_array,\n  max_w_missing,\n  min_w_missing,\n  boxes_overlap,\n  get_bounding_rect,\n  get_css_unit,\n  get_css_value,\n  Selection_Rect,\n  update_rect_with_delta,\n  XY_Pos,\n  Drag_Type,\n} from \"./misc-helpers\";\nimport { make_toggle_switch } from \"./make_toggle_switch\";\nimport { trashcan_icon, drag_icon, se_arrow, nw_arrow } from \"./icons\";\nimport { find_rules_by_selector } from \"./find_rules_by_selector\";\n\nexport const Shiny = (window as any).Shiny;\n\ninterface Grid_Settings {\n  num_rows: (new_value: number) => void;\n  num_cols: (new_value: number) => void;\n  gap: CSS_Input;\n}\n\nexport interface Grid_Pos {\n  start_col?: number;\n  end_col?: number;\n  start_row?: number;\n  end_row?: number;\n}\n\ninterface Drag_Res {\n  xy: XY_Pos;\n  grid: Grid_Pos;\n}\n\ninterface Drag_Options {\n  watching_element: HTMLElement;\n  drag_dir: Drag_Type;\n  grid_element?: HTMLElement;\n  on_start?: (start_loc: XY_Pos) => void;\n  on_drag?: (drag_info: Drag_Res) => void;\n  on_end?: (drag_info: Drag_Res) => void;\n}\n\nconst enum App_Mode {\n  ShinyNew,\n  ShinyExisting,\n  ClientSide,\n}\nwindow.onload = function () {\n  // Keep track of the grid controls here. Tradeoff of a global variable\n  // feels worth it for direct access to the values without doing a dom query\n  const grid_controls = { rows: [], cols: [] };\n  // All the currently existing cells making up the grid\n  let current_cells = [];\n\n  // This holds the grid element dom node. Gets filled in the onload callback\n  // I am using a global variable here because we query inside this so much that\n  // it felt silly to regrab it every time as it never moves.\n  const grid_holder: HTMLElement = document.querySelector(\"#grid_page\");\n\n  const settings_panel: HTMLElement = document.querySelector(\n    \"#settings .card-body\"\n  );\n\n  const grid_settings: Grid_Settings = {\n    num_rows: make_incrementer({\n      parent_el: settings_panel,\n      id: \"num_rows\",\n      start_val: 2,\n      label: \"Number of rows\",\n      on_increment: (x) => update_num_rows_or_cols(\"rows\", x),\n    }),\n    num_cols: make_incrementer({\n      parent_el: settings_panel,\n      id: \"num_cols\",\n      start_val: 2,\n      label: \"Number of cols\",\n      on_increment: (x) => update_num_rows_or_cols(\"cols\", x),\n    }),\n    gap: make_css_unit_input({\n      parent_el: make_el(\n        settings_panel,\n        \"div#gap_size_chooser.plus_minus_input.settings-grid\",\n        {\n          innerHTML: `<span class = \"label\">Panel gap size</span>`,\n        }\n      ),\n      selector: \"#gap_size_chooser\",\n      on_change: (x) => update_grid({ gap: x }),\n      allowed_units: [\"px\", \"rem\"],\n    }),\n  };\n\n  function update_num_rows_or_cols(dir, new_count) {\n    const current_vals =\n      dir === \"rows\" ? get_current_rows() : get_current_cols();\n\n    if (new_count > current_vals.length) {\n      current_vals.push(\"1fr\");\n    } else if (new_count < current_vals.length) {\n      current_vals.pop();\n    } else {\n      // No change, shouldn't happen but maybe...\n    }\n    update_grid({ [dir]: current_vals });\n  }\n\n  const app_mode: App_Mode = grid_holder.hasChildNodes()\n    ? App_Mode.ShinyExisting\n    : Shiny\n    ? App_Mode.ShinyNew\n    : App_Mode.ClientSide;\n\n  if (app_mode === App_Mode.ShinyExisting) {\n    // Container styles are in this object\n    const styles_for_container = find_rules_by_selector(\"#grid_page\", \"gridTemplateColumns\");\n\n    const current_rows = styles_for_container.gridTemplateRows.split(\" \");\n    const current_cols = styles_for_container.gridTemplateColumns.split(\" \");\n    // I dont know why this is just .gap and not gridGap\n    const current_gap = styles_for_container.gap;\n\n    // If grided is running on an existing app, we need to parse the children and\n    // add them as elements;\n    const children = [...grid_holder.children];\n\n    children.forEach(function (el) {\n      add_element({\n        id: el.id,\n        grid_pos: get_grid_pos(el as HTMLElement),\n        existing_element: el as HTMLElement,\n      });\n    });\n\n    // Make sure grid matches the one the app is working with\n    update_grid({\n      rows: current_rows,\n      cols: current_cols,\n      gap: current_gap,\n    });\n\n    // Make grid cells transparent so the app is seen beneath them\n    find_rules_by_selector(\".grid-cell\").background = \"none\";\n\n    // And edit mode toggle to allow user to interact with app \n    make_toggle_switch(\n      document.querySelector(\"#header .code_btns\"),\n      \"Edit layout\",\n      \"Interact mode\",\n      (interact_is_on: boolean) => {\n        const update_el = function (el: Element) {\n          if (interact_is_on) {\n            el.classList.add(\"disabled\");\n          } else {\n            el.classList.remove(\"disabled\");\n          }\n        };\n        document.querySelectorAll(\".added-element\").forEach(update_el);\n        document.querySelectorAll(\".grid-cell\").forEach(update_el);\n        update_el(document.querySelector(\"#drag_canvas\"));\n      }\n    );\n\n  } else if (app_mode === App_Mode.ShinyNew) {\n    Shiny.addCustomMessageHandler(\"update-grid\", function (opts) {\n      update_grid(opts);\n    });\n\n    interface Shiny_Element_Msg {\n      id: string;\n      start_row: number;\n      end_row: number;\n      start_col: number;\n      end_col: number;\n    }\n    Shiny.addCustomMessageHandler(\"add-elements\", function (\n      elements_to_add: Shiny_Element_Msg[]\n    ) {\n      elements_to_add.forEach((el: Shiny_Element_Msg) => {\n        add_element({\n          id: el.id,\n          grid_pos: el,\n        });\n      });\n    });\n\n    Shiny.addCustomMessageHandler(\"code_modal\", function (code_to_show) {\n      show_code(\"Paste the following code into your app to update the layout\", {\n        type: \"R\",\n        code: code_to_show,\n      });\n    });\n  } else {\n    // If in pure-client-side mode we need to provide a default grid and also wireup the code button\n    update_grid({\n      rows: [\"1fr\", \"1fr\"],\n      cols: [\"1fr\", \"1fr\"],\n      gap: \"1rem\",\n    });\n\n    document.getElementById(\"get_code\").addEventListener(\"click\", function () {\n      const current_layout = gen_code_for_layout();\n      show_code(\"Place the following in your CSS:\", current_layout);\n    });\n  }\n  interface Code_Text {\n    type: string;\n    code: string;\n  }\n  function show_code(\n    message: string,\n    code_blocks: Code_Text | Array<Code_Text>\n  ) {\n    const code_modal = focused_modal({\n      header_text: `${message}`,\n      modal_callbacks: {\n        event: \"click\",\n        func: function (event) {\n          // This is needed to stop clicks on modal from triggering the cancel\n          // event that is attached to the background\n          event.stopPropagation();\n        },\n      },\n      background_callbacks: {\n        event: \"click\",\n        func: close_modal,\n      },\n    });\n\n    as_array(code_blocks).forEach(function (code_to_show) {\n      const num_of_lines: number = code_to_show.code.match(/\\n/g).length;\n\n      const code_section = make_el(\n        code_modal.modal,\n        `div#${code_to_show.type}.code_chunk`,\n        {\n          styles: {\n            display: \"grid\",\n            gridTemplateColumns: \"repeat(2, 1fr)\",\n            gridTemplateRows: \"1fr, auto\",\n            gridGap: \"4px\",\n            gridTemplateAreas: concat_nl(\n              `\"code_type copy_btn\"`,\n              `\"code_text code_text\"`\n            ),\n          },\n        }\n      );\n\n      let code_text: HTMLInputElement;\n\n      make_el(code_section, \"strong\", {\n        innerHTML: code_to_show.type,\n        styles: { gridArea: \"code_type\" },\n      });\n\n      make_el(code_section, \"button#copy_code\", {\n        innerHTML: \"Copy to clipboard\",\n        styles: { gridArea: \"copy_btn\" },\n        event_listener: {\n          event: \"click\",\n          func: function () {\n            code_text.select();\n            document.execCommand(\"copy\");\n          },\n        },\n      });\n\n      code_text = make_el(code_section, \"textarea#code_for_layout\", {\n        innerHTML: code_to_show.code,\n        props: { rows: num_of_lines + 3 },\n        styles: {\n          width: \"100%\",\n          background: \"#f3f2f2\",\n          fontFamily: \"monospace\",\n          display: \"block\",\n          padding: \"0.75rem\",\n          marginBottom: \"10px\",\n          borderRadius: \"5px\",\n          gridArea: \"code_text\",\n        },\n      }) as HTMLInputElement;\n    });\n\n    const action_buttons = make_el(code_modal.modal, \"div#action_buttons\", {\n      styles: {\n        display: \"flex\",\n        justifyContent: \"space-around\",\n      },\n    });\n    make_el(action_buttons, \"button#close_code_model\", {\n      innerHTML: \"Close\",\n      event_listener: {\n        event: \"click\",\n        func: close_modal,\n      },\n    });\n\n    function close_modal() {\n      code_modal.remove();\n    }\n  }\n\n  function fill_grid_cells() {\n    const grid_dims = { rows: get_current_rows(), cols: get_current_cols() };\n    const num_rows = grid_dims.rows.length;\n    const num_cols = grid_dims.cols.length;\n    // Grab currently drawn cells (if any) so we can check if we need to redraw\n    // or if this was simply a column/row sizing update\n    current_cells = [];\n    const need_to_reset_cells = current_cells.length != num_rows * num_cols;\n\n    if (need_to_reset_cells) {\n      remove_elements(grid_holder.querySelectorAll(\".grid-cell\"));\n      for (let row_i = 1; row_i <= num_rows; row_i++) {\n        for (let col_i = 1; col_i <= num_cols; col_i++) {\n          current_cells.push(\n            make_el(grid_holder, `div.r${row_i}.c${col_i}.grid-cell`, {\n              data_props: { row: row_i, col: col_i },\n              grid_pos: { start_row: row_i, start_col: col_i },\n            })\n          );\n        }\n      }\n\n      // Build each column and row's sizing controler\n      for (let type in grid_controls) {\n        // Get rid of old ones to start with fresh slate\n        remove_elements(grid_holder.querySelectorAll(`.${type}-controls`));\n        grid_controls[type] = grid_dims[type].map(function (\n          size: string,\n          i: number\n        ) {\n          // The i + 1 is because grid is indexed at 1, not zero\n          const grid_i = i + 1;\n\n          return make_css_unit_input({\n            parent_el: grid_holder,\n            selector: `#control_${type}${grid_i}.${type}-controls`,\n            start_val: get_css_value(size),\n            start_unit: get_css_unit(size),\n            on_change: () => update_grid(get_layout_from_controls()),\n            form_styles: {\n              [`grid${\n                type === \"rows\" ? \"Row\" : \"Column\"\n              }`]: make_template_start_end(grid_i),\n            },\n            drag_dir: type === \"rows\" ? \"y\" : \"x\",\n          });\n        });\n      }\n      const current_selection_box = make_el(\n        grid_holder,\n        \"div#current_selection_box.added-element\"\n      );\n      const drag_canvas = make_el(grid_holder, \"div#drag_canvas\");\n\n      drag_on_grid({\n        watching_element: drag_canvas,\n        grid_element: current_selection_box,\n        drag_dir: Drag_Type.bottom_right,\n        on_start: () => {\n          current_selection_box.style.borderColor = get_next_color();\n        },\n        on_end: ({ grid }) => {\n          name_new_element({\n            grid_pos: grid,\n            selection_box: current_selection_box,\n          });\n        },\n      });\n\n      // Make sure any added elements sit on top by re-appending them to grid holder\n      // Make sure that the drag detector sits over everything\n      [\n        drag_canvas,\n        ...grid_holder.querySelectorAll(\".added-element\"),\n      ].forEach((el) => grid_holder.appendChild(el));\n    } else {\n    }\n  }\n  function get_drag_extent_on_grid(selection_rect: Selection_Rect): Grid_Pos {\n    // Reset bounding box definitions so we only use current selection extent\n    const sel_bounds: Grid_Pos = { start_col: null, start_row: null };\n\n    current_cells.forEach(function (el) {\n      // Cell is overlapped by selection box\n      if (boxes_overlap(get_bounding_rect(el), selection_rect)) {\n        const el_row: number = +el.dataset.row;\n        const el_col: number = +el.dataset.col;\n        sel_bounds.start_row = min_w_missing(sel_bounds.start_row, el_row);\n        sel_bounds.end_row = max_w_missing(sel_bounds.end_row, el_row);\n        sel_bounds.start_col = min_w_missing(sel_bounds.start_col, el_col);\n        sel_bounds.end_col = max_w_missing(sel_bounds.end_col, el_col);\n      }\n    });\n\n    return sel_bounds;\n  }\n\n  interface Grid_Update_Options {\n    rows?: Array<string>;\n    cols?: Array<string>;\n    gap?: string;\n  }\n  function update_grid(opts: Grid_Update_Options) {\n    const old_num_rows = get_current_rows().length;\n    const old_num_cols = get_current_cols().length;\n    const old_gap = grid_holder.style.getPropertyValue(\"--grid-gap\");\n    const new_gap = opts.gap || old_gap;\n    const new_num_rows = opts.rows ? opts.rows.length : old_num_rows;\n    const new_num_cols = opts.cols ? opts.cols.length : old_num_cols;\n\n    // Make sure settings panel is up-to-date\n    grid_settings.num_rows(new_num_rows);\n    grid_settings.num_cols(new_num_cols);\n    grid_settings.gap.update_value(new_gap);\n\n    const grid_numbers_changed =\n      old_num_rows !== new_num_rows || old_num_cols !== new_num_cols;\n    if (grid_numbers_changed) {\n      // Check for elements that may get dropped\n      const all_els = current_elements();\n      let in_danger_els = [];\n      let auto_removed_el_ids = [];\n\n      all_els.forEach(function (el) {\n        const sits_outside_grid =\n          el.end_row > new_num_rows || el.end_col > new_num_cols;\n        const completely_outside_grid =\n          el.start_row > new_num_rows || el.start_col > new_num_cols;\n\n        if (completely_outside_grid) {\n          auto_removed_el_ids.push(el.id);\n        } else if (sits_outside_grid) {\n          in_danger_els.push(el);\n        }\n      });\n\n      remove_added_elements(auto_removed_el_ids);\n\n      if (in_danger_els.length > 0) {\n        const fix_els_modal = focused_modal({\n          header_text: `\n        <h2>The following elements dont fit on the new grid layout.</h2>\n        <p>Below, choose to either remove the element or to shink its bounds to the new grid sizing</p>\n        `,\n        });\n\n        const radio_inputs_html = in_danger_els.reduce(\n          (radio_group, el) =>\n            `\n          ${radio_group}\n          <div class = \"radio-set-group\">\n            <div class = \"radio-set-label\"> ${el.id} </div>\n            <div class = \"radio-set-options\">\n              <input type=\"radio\" id = \"delete_${el.id}\" name=\"${el.id}\" value=\"delete\" checked>\n              <label for=\"delete_${el.id}\">Delete</label>\n              <input type=\"radio\" id = \"shrink_${el.id}\" name=\"${el.id}\" value=\"shrink\">\n              <label for=\"shrink_${el.id}\">Shink</label>\n            </div>\n          </div>\n        `,\n          \"\"\n        );\n\n        const delete_or_edit_form = make_el(\n          fix_els_modal.modal,\n          \"form#delete_or_fix_list\",\n          {\n            innerHTML: `<div class = \"update-action-form\"> ${radio_inputs_html} </div>`,\n            event_listener: {\n              event: \"submit\",\n              func: function () {\n                const form = this;\n                const to_delete = in_danger_els.filter(\n                  (d) => form[d.id].value === \"delete\"\n                );\n\n                remove_added_elements(to_delete.map((d) => d.id));\n                const to_edit = in_danger_els.filter(\n                  (d) => form[d.id].value === \"shrink\"\n                );\n                to_edit.forEach((el) => {\n                  const el_node: HTMLElement = grid_holder.querySelector(\n                    `#${el.id}`\n                  );\n\n                  el_node.style.gridRow = make_template_start_end(\n                    el.start_row,\n                    Math.min(el.end_row, new_num_rows)\n                  );\n                  el_node.style.gridColumn = make_template_start_end(\n                    el.start_col,\n                    Math.min(el.end_col, new_num_cols)\n                  );\n                });\n\n                fix_els_modal.remove();\n                // Now that we've updated elements properly, we should be able to\n                // just recall the function and it won't spit an error\n                update_grid({\n                  rows: opts.rows,\n                  cols: opts.cols,\n                  gap: opts.gap,\n                });\n              },\n            },\n          }\n        );\n\n        make_el(delete_or_edit_form, \"input#name_submit\", {\n          props: { type: \"submit\" },\n        });\n\n        make_el(fix_els_modal.modal, \"p.notice-text\", {\n          innerHTML:\n            \"Note that elements residing completely in the removed row or column are automatically deleted.\",\n        });\n\n        return;\n      }\n    }\n\n    if (opts.rows) {\n      grid_holder.style.gridTemplateRows = sizes_to_template_def(opts.rows);\n    }\n    if (opts.cols) {\n      grid_holder.style.gridTemplateColumns = sizes_to_template_def(opts.cols);\n    }\n    if (opts.gap) {\n      // To give a consistant gap around everything we also add margin of same size\n      grid_holder.style.setProperty(\"--grid-gap\", opts.gap);\n    }\n\n    if (grid_numbers_changed) fill_grid_cells();\n\n    if (app_mode == App_Mode.ShinyNew) {\n      Shiny.setInputValue(\"grid_sizing\", {\n        rows: grid_holder.style.gridTemplateRows.split(\" \"),\n        cols: grid_holder.style.gridTemplateColumns.split(\" \"),\n        gap: grid_holder.style.getPropertyValue(\"--grid-gap\"),\n      });\n    }\n\n    return grid_holder;\n  }\n\n  function get_layout_from_controls() {\n    const sizes = {};\n    for (let type in grid_controls) {\n      sizes[type] = grid_controls[type].map((unit_input) =>\n        unit_input.current_value()\n      );\n    }\n    return sizes;\n  }\n\n  function name_new_element({ grid_pos, selection_box }) {\n    const modal_divs = focused_modal({\n      background_callbacks: {\n        // Clicking outside of the modal will cancel the naming. Seems natural\n        event: \"click\",\n        func: reset_el_creation,\n      },\n      modal_callbacks: {\n        event: \"click\",\n        func: function (event) {\n          // This is needed to stop clicks on modal from triggering the cancel\n          // event that is attached to the background\n          event.stopPropagation();\n        },\n      },\n    });\n\n    const modal_div = modal_divs.modal;\n\n    make_el(modal_div, \"div.instructions\", {\n      innerHTML: `\n      <h2>Name your element:</h2>\n      <p>This name will be used to place items in your app.\n      For instance if you want to place a plot in this element,\n      this name will match the label of the plot output\n      </p>\n      `,\n    });\n\n    const name_form = make_el(modal_div, \"form#name_form\", {\n      event_listener: {\n        event: \"submit\",\n        func: function (event) {\n          event.preventDefault();\n          const id = this[\"name_input\"].value.replace(/\\s/g, \"_\");\n\n          const element_exists: boolean = !!current_elements().find(\n            (el) => el.id === id\n          );\n          if (element_exists) {\n            // Cant have duplicate ids!\n            warn_about_bad_id(\n              `You already have an element with the id ${id}, all ids need to be unique.`\n            );\n            return;\n          }\n          if (id.match(/^[^a-zA-Z]/g)) {\n            warn_about_bad_id(`Valid ids need to start with a character.`);\n            return;\n          }\n\n          // Add the new element in to grid\n          add_element({\n            id,\n            color: selection_box.style.borderColor,\n            grid_pos,\n          });\n\n          reset_el_creation();\n        },\n      },\n    });\n    make_el(name_form, \"input#cancel_btn\", {\n      props: { type: \"button\", value: \"cancel\" },\n      event_listener: { event: \"click\", func: reset_el_creation },\n    });\n\n    make_el(name_form, \"input#name_input\", {\n      props: { type: \"text\" },\n      event_listener: {\n        // Don't leave warning message up while user is typing\n        event: \"input\",\n        func: hide_warning_msg,\n      },\n    }).focus(); // So user can immediately type in id\n\n    make_el(name_form, \"input#name_submit\", {\n      props: { type: \"submit\" },\n    });\n\n    function warn_about_bad_id(msg) {\n      make_el(modal_div, \"span#bad_id_msg.notice-text\", {\n        innerHTML: msg,\n        styles: { color: \"orangered\" },\n      });\n    }\n    function hide_warning_msg() {\n      const warn_msg = modal_div.querySelector(\"span#bad_id_msg\");\n      if (warn_msg) {\n        warn_msg.remove();\n      }\n    }\n    function reset_el_creation() {\n      // All done here so get rid of the whole interface.\n      modal_divs.remove();\n      // Remove the temporary dragged element\n      selection_box.style.display = \"none\";\n    }\n  }\n\n  // Adds a new element of a given id to the app. Both in the grid window\n  // and the addeded elements panel\n  interface New_Element {\n    id: string;\n    color?: string;\n    grid_pos: Grid_Pos;\n    existing_element?: HTMLElement;\n  }\n\n  function add_element(el_props: New_Element) {\n    const { grid_pos, color = get_next_color(), existing_element } = el_props;\n    const mirrors_existing_element = existing_element !== undefined;\n    // If element ids were generated with the grid_container R function then\n    // they have a prefix of the container name which we should remove so the\n    // added elements list is not ugly looking\n    const id = mirrors_existing_element\n      ? el_props.id.replace(/^.+?__/g, \"\")\n      : el_props.id;\n\n    const element_in_grid = make_el(\n      grid_holder,\n      `div#${id}.el_${id}.added-element`,\n      {\n        grid_pos,\n        styles: {\n          borderColor: color,\n          position: \"relative\",\n        },\n      }\n    );\n\n    // Setup drag behavior\n    [Drag_Type.top_left, Drag_Type.bottom_right, Drag_Type.center].forEach(\n      function (handle_type) {\n        drag_on_grid({\n          watching_element: make_el(\n            element_in_grid,\n            `div.dragger.visible.${handle_type}`,\n            {\n              styles: { background: color },\n              innerHTML:\n                handle_type === \"center\"\n                  ? drag_icon\n                  : handle_type === Drag_Type.bottom_right\n                  ? se_arrow\n                  : nw_arrow,\n            }\n          ),\n          grid_element: element_in_grid,\n          drag_dir: handle_type,\n          on_drag: (res) => {\n            if (mirrors_existing_element) {\n              set_element_in_grid(existing_element, res.grid);\n            }\n          },\n          on_end: () => {\n            send_elements_to_shiny();\n          },\n        });\n      }\n    );\n\n    const element_in_list = make_el(\n      document.querySelector(\"#added_elements\"),\n      `div.el_${id}.added-element`,\n      {\n        innerHTML: id,\n        styles: {\n          borderColor: color,\n        },\n        event_listener: [\n          {\n            event: \"mouseover\",\n            func: function () {\n              this.classList.add(\"hovered\");\n              element_in_grid.classList.add(\"hovered\");\n            },\n          },\n          {\n            event: \"mouseout\",\n            func: function () {\n              this.classList.remove(\"hovered\");\n              element_in_grid.classList.remove(\"hovered\");\n            },\n          },\n        ],\n      }\n    );\n\n    if (!mirrors_existing_element) {\n      // Turn of deleting if were editing an existing app\n      // This means that if were in app editing mode and the user adds a new element\n      // they can delete that new element but they can't delete the existing elements\n      make_el(element_in_list, \"button.remove_el\", {\n        innerHTML: trashcan_icon,\n        event_listener: {\n          event: \"click\",\n          func: function () {\n            remove_added_elements(id);\n          },\n        },\n      });\n    }\n\n    // Let shiny know we have a new element\n    send_elements_to_shiny();\n  }\n\n  function get_grid_pos(grid_el: HTMLElement): Grid_Pos {\n    const el_styles = getComputedStyle(grid_el);\n    return {\n      start_row: +el_styles.gridRowStart,\n      start_col: +el_styles.gridColumnStart,\n      end_row: +el_styles.gridRowEnd - 1,\n      end_col: +el_styles.gridColumnEnd - 1,\n    };\n  }\n\n  function drag_on_grid(opts: Drag_Options): void {\n    let drag_feedback_rect: HTMLElement;\n    let start_rect: Selection_Rect;\n    let start_loc: XY_Pos;\n\n    const editor_el: HTMLElement = document.querySelector(\"#editor\");\n\n    opts.watching_element.onmousedown = function (event: MouseEvent) {\n      start_loc = event as DragEvent;\n\n      // make sure dragged element is on top\n      grid_holder.appendChild(opts.grid_element);\n\n      // If this is a new element drag there wont be a bounding box for the grid\n      // element yet, so we need to make a new zero-width/height one at start\n      // of the drag\n      start_rect = get_bounding_rect(opts.grid_element) || {\n        left: event.offsetX,\n        right: event.offsetX,\n        top: event.offsetY,\n        bottom: event.offsetY,\n      };\n\n      drag_feedback_rect = make_el(\n        grid_holder.querySelector(\"#drag_canvas\"),\n        \"div.drag-feedback-rect\",\n        {\n          styles: {\n            ...bounding_rect_to_css_pos(start_rect),\n          },\n        }\n      );\n\n      // We start grid position here in case user selects by simply clicking,\n      // which would mean we never get to run the drag function\n      update_grid_pos(opts.grid_element, start_rect);\n\n      if (opts.on_start) opts.on_start(start_loc);\n\n      // Add listener to editor so we can continue to track this drag\n      editor_el.addEventListener(\"mousemove\", drag);\n      editor_el.addEventListener(\"mouseup\", drag_end);\n    };\n\n    function update_grid_pos(\n      element: HTMLElement,\n      bounding_rect: Selection_Rect\n    ): Grid_Pos {\n      const grid_extent = get_drag_extent_on_grid(bounding_rect);\n      set_element_in_grid(element, grid_extent);\n      return grid_extent;\n    }\n\n    function drag(event: MouseEvent) {\n      const curr_loc: XY_Pos = event;\n      // Sometimes the drag event gets fired with nonsense zeros\n      if (curr_loc.x === 0 && curr_loc.y === 0) return;\n\n      const new_rect = update_rect_with_delta(\n        start_rect,\n        { x: curr_loc.x - start_loc.x, y: curr_loc.y - start_loc.y },\n        opts.drag_dir\n      );\n\n      Object.assign(\n        drag_feedback_rect.style,\n        bounding_rect_to_css_pos(new_rect)\n      );\n      const grid_extent = update_grid_pos(opts.grid_element, new_rect);\n      if (opts.on_drag) opts.on_drag({ xy: curr_loc, grid: grid_extent });\n    }\n\n    function drag_end(event: MouseEvent) {\n      const end_loc: XY_Pos = event;\n      drag_feedback_rect.remove();\n      start_rect = null;\n      start_loc = null;\n      if (opts.on_end)\n        opts.on_end({\n          xy: end_loc,\n          grid: get_grid_pos(opts.grid_element || this.parentElement),\n        });\n\n      editor_el.removeEventListener(\"mousemove\", drag);\n      editor_el.removeEventListener(\"mouseup\", drag_end);\n    }\n\n    function bounding_rect_to_css_pos(rect: Selection_Rect) {\n      return {\n        left: `${rect.left}px`,\n        top: `${rect.top}px`,\n        width: `${rect.right - rect.left}px`,\n        height: `${rect.bottom - rect.top}px`,\n      };\n    }\n  }\n\n  interface Element_Info {\n    id: string;\n    start_row: number;\n    end_row: number;\n    start_col: number;\n    end_col: number;\n  }\n\n  function current_elements(): Array<Element_Info> {\n    let elements: Array<Element_Info> = [];\n\n    (grid_holder.querySelectorAll(\".added-element\") as NodeListOf<\n      HTMLElement\n    >).forEach(function (el: HTMLElement) {\n      // Ignore the selection box\n      if (el.id === \"current_selection_box\") return;\n      const grid_area = el.style.gridArea.split(\" / \");\n      elements.push({\n        id: el.id,\n        start_row: +grid_area[0],\n        start_col: +grid_area[1],\n        // Subtract one here because the end in css is the end line, not row\n        end_row: +grid_area[2] - 1,\n        end_col: +grid_area[3] - 1,\n      });\n    });\n\n    return elements;\n  }\n\n  function send_elements_to_shiny() {\n    if (app_mode == App_Mode.ShinyNew) {\n      const elements_by_id = {};\n      current_elements().forEach(function (el) {\n        elements_by_id[el.id] = el;\n      });\n      Shiny.setInputValue(\"elements\", elements_by_id);\n    }\n  }\n\n  function gen_code_for_layout(): Array<Code_Text> {\n    const container_selector = \"#container\";\n    const elements = current_elements();\n\n    const element_defs = elements.map((el) =>\n      concat_nl(\n        `#${el.id} {`,\n        `  grid-column: ${make_template_start_end(el.start_col, el.end_col)};`,\n        `  grid-row: ${make_template_start_end(el.start_row, el.end_row)};`,\n        `}`\n      )\n    );\n\n    const css_code = concat_nl(\n      `${container_selector} {`,\n      `  display: grid;`,\n      `  grid-template-columns: ${grid_holder.style.gridTemplateColumns};`,\n      `  grid-template-rows: ${grid_holder.style.gridTemplateRows};`,\n      `  grid-gap: ${grid_holder.style.getPropertyValue(\"--grid-gap\")}`,\n      `}`,\n      ...element_defs\n    );\n\n    const html_code = concat_nl(\n      `<div id = ${container_selector}>`,\n      ...elements.map((el) =>\n        concat_nl(`  <div id = \"#${el.id}\">`, `  </div>`)\n      ),\n      `</div>`\n    );\n\n    return [\n      { type: \"css\", code: css_code },\n      { type: \"html\", code: html_code },\n    ];\n  }\n\n  function get_current_rows() {\n    return grid_holder.style.gridTemplateRows.split(\" \");\n  }\n\n  function get_current_cols() {\n    return grid_holder.style.gridTemplateColumns.split(\" \");\n  }\n\n  // Get the next color in our list of colors.\n  function get_next_color() {\n    const colors = [\n      \"#e41a1c\",\n      \"#377eb8\",\n      \"#4daf4a\",\n      \"#984ea3\",\n      \"#ff7f00\",\n      \"#a65628\",\n      \"#f781bf\",\n    ];\n    const all_elements = grid_holder.querySelectorAll(\".added-element\");\n    // If we have more elements than colors we simply recycle\n    return colors[all_elements.length % colors.length];\n  }\n\n  // Removes elements the user has added to the grid by id\n  function remove_added_elements(ids: string | Array<string>) {\n    as_array(ids).forEach((el_id) => {\n      remove_elements(\n        document.querySelectorAll(`div.el_${el_id}.added-element`)\n      );\n    });\n\n    send_elements_to_shiny();\n  }\n}; // End of the window.onload callback\n"]}