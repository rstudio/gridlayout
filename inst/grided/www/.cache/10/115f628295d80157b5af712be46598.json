{"id":"QCba","dependencies":[{"name":"/Users/nick/package.json","includedInParent":true,"mtime":1614354832405},{"name":"./make_el","loc":{"line":21,"column":24},"parent":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/index.ts","resolved":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/make_el.ts"},{"name":"./draw_browser_header","loc":{"line":22,"column":36},"parent":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/index.ts","resolved":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/draw_browser_header.ts"},{"name":"./make_incrementer","loc":{"line":23,"column":33},"parent":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/index.ts","resolved":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/make_incrementer.ts"},{"name":"./focused_modal","loc":{"line":24,"column":30},"parent":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/index.ts","resolved":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/focused_modal.ts"},{"name":"./make_css_unit_input","loc":{"line":25,"column":36},"parent":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/index.ts","resolved":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/make_css_unit_input.ts"},{"name":"./misc-helpers","loc":{"line":26,"column":29},"parent":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/index.ts","resolved":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/misc-helpers.ts"},{"name":"./icons","loc":{"line":27,"column":22},"parent":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/index.ts","resolved":"/Users/nick/rstudio/shiny_apps/gridlayout/inst/griditor/www/icons.ts"}],"generated":{"js":"\"use strict\";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},t=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e};Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.Shiny=void 0;var n=require(\"./make_el\"),r=require(\"./draw_browser_header\"),o=require(\"./make_incrementer\"),i=require(\"./focused_modal\"),a=require(\"./make_css_unit_input\"),l=require(\"./misc-helpers\"),s=require(\"./icons\");exports.Shiny=window.Shiny,window.onload=function(){r.draw_browser_header();var d={rows:[],cols:[]},c=[],_=document.querySelector(\"#grid_holder\"),u=document.querySelector(\"#settings .card-body\"),m={num_rows:o.make_incrementer({parent_el:u,id:\"num_rows\",start_val:2,label:\"Number of rows\",on_increment:function(e){return p(\"rows\",e)}}),num_cols:o.make_incrementer({parent_el:u,id:\"num_cols\",start_val:2,label:\"Number of cols\",on_increment:function(e){return p(\"cols\",e)}}),gap:a.make_css_unit_input({parent_el:n.make_el(u,\"div#gap_size_chooser.plus_minus_input.settings-grid\",{innerHTML:'<span class = \"label\">Panel gap size</span>'}),selector:\"#gap_size_chooser\",on_change:function(e){return v({gap:e})},allowed_units:[\"px\",\"rem\"]})};function p(e,t){var n,r=\"rows\"===e?k():x();t>r.length?r.push(\"1fr\"):t<r.length&&r.pop(),v(((n={})[e]=r,n))}function f(e,t){var r=i.focused_modal({header_text:\"\"+e,modal_callbacks:{event:\"click\",func:function(e){e.stopPropagation()}},background_callbacks:{event:\"click\",func:a}});l.as_array(t).forEach(function(e){var t,o=e.code.match(/\\n/g).length,i=n.make_el(r.modal,\"div#\"+e.type+\".code_chunk\",{styles:{display:\"grid\",gridTemplateColumns:\"repeat(2, 1fr)\",gridTemplateRows:\"1fr, auto\",gridGap:\"4px\",gridTemplateAreas:l.concat_nl('\"code_type copy_btn\"','\"code_text code_text\"')}});n.make_el(i,\"strong\",{innerHTML:e.type,styles:{gridArea:\"code_type\"}}),n.make_el(i,\"button#copy_code\",{innerHTML:\"Copy to clipboard\",styles:{gridArea:\"copy_btn\"},event_listener:{event:\"click\",func:function(){t.select(),document.execCommand(\"copy\")}}}),t=n.make_el(i,\"textarea#code_for_layout\",{innerHTML:e.code,props:{rows:o+3},styles:{width:\"100%\",background:\"#f3f2f2\",fontFamily:\"monospace\",display:\"block\",padding:\"0.75rem\",marginBottom:\"10px\",borderRadius:\"5px\",gridArea:\"code_text\"}})});var o=n.make_el(r.modal,\"div#action_buttons\",{styles:{display:\"flex\",justifyContent:\"space-around\"}});function a(){r.remove()}n.make_el(o,\"button#close_code_model\",{innerHTML:\"Close\",event_listener:{event:\"click\",func:a}})}function g(){var e={rows:k(),cols:x()},r=e.rows.length,o=e.cols.length;if((c=[]).length!=r*o){n.remove_elements(_.querySelectorAll(\".grid-cell\"));for(var s=1;s<=r;s++)for(var u=1;u<=o;u++)c.push(n.make_el(_,\"div.r\"+s+\".c\"+u+\".grid-cell\",{data_props:{row:s,col:u},grid_pos:{start_row:s,start_col:u}}));var m=function(t){n.remove_elements(_.querySelectorAll(\".\"+t+\"-controls\")),d[t]=e[t].map(function(e,n){var r,o=n+1;return a.make_css_unit_input({parent_el:_,selector:\"#control_\"+t+o+\".\"+t+\"-controls\",start_val:l.get_css_value(e),start_unit:l.get_css_unit(e),on_change:function(){return v(function(){var e={};for(var t in d)e[t]=d[t].map(function(e){return e.current_value()});return e}())},form_styles:(r={},r[\"grid\"+(\"rows\"===t?\"Row\":\"Column\")]=l.make_template_start_end(o),r),drag_dir:\"rows\"===t?\"y\":\"x\"})})};for(var p in d)m(p);var f=n.make_el(_,\"div#current_selection_box.added-element\"),g=n.make_el(_,\"div#drag_canvas\");y({watching_element:g,grid_element:f,drag_dir:l.Drag_Type.bottom_right,on_start:function(){f.style.borderColor=T()},on_end:function(e){!function(e){var t=e.grid_pos,r=e.selection_box,o=i.focused_modal({background_callbacks:{event:\"click\",func:d},modal_callbacks:{event:\"click\",func:function(e){e.stopPropagation()}}}),a=o.modal;n.make_el(a,\"div.instructions\",{innerHTML:\"\\n      <h2>Name your element:</h2>\\n      <p>This name will be used to place items in your app.\\n      For instance if you want to place a plot in this element,\\n      this name will match the label of the plot output\\n      </p>\\n      \"});var l=n.make_el(a,\"form#name_form\",{event_listener:{event:\"submit\",func:function(){var e=this.name_input.value.replace(/\\s/g,\"_\"),n=!!w().find(function(t){return t.id===e});n?s(\"You already have an element with the id \"+e+\", all ids need to be unique.\"):e.match(/^[^a-zA-Z]/g)?s(\"Valid ids need to start with a character.\"):(h({id:e,color:r.style.borderColor,grid_pos:t}),d())}}});function s(e){n.make_el(a,\"span#bad_id_msg.notice-text\",{innerHTML:e,styles:{color:\"orangered\"}})}function d(){o.remove(),r.style.display=\"none\"}n.make_el(l,\"input#cancel_btn\",{props:{type:\"button\",value:\"cancel\"},event_listener:{event:\"click\",func:d}}),n.make_el(l,\"input#name_input\",{props:{type:\"text\"},event_listener:{event:\"input\",func:function(){var e=a.querySelector(\"span#bad_id_msg\");e&&e.remove()}}}).focus(),n.make_el(l,\"input#name_submit\",{props:{type:\"submit\"}})}({grid_pos:e.grid,selection_box:f})}}),t([g],_.querySelectorAll(\".added-element\")).forEach(function(e){return _.appendChild(e)})}}function v(e){var t=k().length,r=x().length,o=_.style.getPropertyValue(\"--grid-gap\"),a=e.gap||o,s=e.rows?e.rows.length:t,d=e.cols?e.cols.length:r;m.num_rows(s),m.num_cols(d),m.gap.update_value(a);var c=t!==s||r!==d;if(c){var u=w(),p=[],f=[];if(u.forEach(function(e){var t=e.end_row>s||e.end_col>d;e.start_row>s||e.start_col>d?f.push(e.id):t&&p.push(e)}),S(f),p.length>0){var h=i.focused_modal({header_text:\"\\n        <h2>The following elements dont fit on the new grid layout.</h2>\\n        <p>Below, choose to either remove the element or to shink its bounds to the new grid sizing</p>\\n        \"}),y=p.reduce(function(e,t){return\"\\n          \"+e+'\\n          <div class = \"radio-set-group\">\\n            <div class = \"radio-set-label\"> '+t.id+' </div>\\n            <div class = \"radio-set-options\">\\n              <input type=\"radio\" id = \"delete_'+t.id+'\" name=\"'+t.id+'\" value=\"delete\" checked>\\n              <label for=\"delete_'+t.id+'\">Delete</label>\\n              <input type=\"radio\" id = \"shrink_'+t.id+'\" name=\"'+t.id+'\" value=\"shrink\">\\n              <label for=\"shrink_'+t.id+'\">Shink</label>\\n            </div>\\n          </div>\\n        '},\"\"),b=n.make_el(h.modal,\"form#delete_or_fix_list\",{innerHTML:'<div class = \"update-action-form\"> '+y+\" </div>\",event_listener:{event:\"submit\",func:function(){var t=this;S(p.filter(function(e){return\"delete\"===t[e.id].value}).map(function(e){return e.id})),p.filter(function(e){return\"shrink\"===t[e.id].value}).forEach(function(e){var t=_.querySelector(\"#\"+e.id);t.style.gridRow=l.make_template_start_end(e.start_row,Math.min(e.end_row,s)),t.style.gridColumn=l.make_template_start_end(e.start_col,Math.min(e.end_col,d))}),h.remove(),v({rows:e.rows,cols:e.cols,gap:e.gap})}}});return n.make_el(b,\"input#name_submit\",{props:{type:\"submit\"}}),void n.make_el(h.modal,\"p.notice-text\",{innerHTML:\"Note that elements residing completely in the removed row or column are automatically deleted.\"})}}return e.rows&&(_.style.gridTemplateRows=l.sizes_to_template_def(e.rows)),e.cols&&(_.style.gridTemplateColumns=l.sizes_to_template_def(e.cols)),e.gap&&_.style.setProperty(\"--grid-gap\",e.gap),c&&g(),exports.Shiny&&exports.Shiny.setInputValue(\"grid_sizing\",{rows:_.style.gridTemplateRows.split(\" \"),cols:_.style.gridTemplateColumns.split(\" \"),gap:_.style.getPropertyValue(\"--grid-gap\")}),_}function h(e){var t=e.id,r=e.color,o=void 0===r?T():r,i=e.grid_pos,a=n.make_el(_,\"div#\"+t+\".el_\"+t+\".added-element\",{grid_pos:i,styles:{borderColor:o,position:\"relative\"}});[l.Drag_Type.top_left,l.Drag_Type.bottom_right,l.Drag_Type.center].forEach(function(e){y({watching_element:n.make_el(a,\"div.dragger.visible.\"+e,{styles:{background:o},innerHTML:\"center\"===e?s.drag_icon:e===l.Drag_Type.bottom_right?s.se_arrow:s.nw_arrow}),grid_element:a,drag_dir:e})});var d=n.make_el(document.querySelector(\"#added_elements\"),\"div.el_\"+t+\".added-element\",{innerHTML:t,styles:{borderColor:o},event_listener:[{event:\"mouseover\",func:function(){this.classList.add(\"hovered\"),a.classList.add(\"hovered\")}},{event:\"mouseout\",func:function(){this.classList.remove(\"hovered\"),a.classList.remove(\"hovered\")}}]});n.make_el(d,\"button.remove_el\",{innerHTML:s.trashcan_icon,event_listener:{event:\"click\",func:function(){S(t)}}}),b()}function y(t){var r,o,i,a=document.querySelector(\"#editor\");function s(e){var n=e;if(0!==n.x||0!==n.y){var a=l.update_rect_with_delta(o,{x:n.x-i.x,y:n.y-i.y},t.drag_dir);Object.assign(r.style,u(a));var s,d,_=(s=a,d={start_col:null,start_row:null},c.forEach(function(e){if(l.boxes_overlap(l.get_bounding_rect(e),s)){var t=+e.dataset.row,n=+e.dataset.col;d.start_row=l.min_w_missing(d.start_row,t),d.end_row=l.max_w_missing(d.end_row,t),d.start_col=l.min_w_missing(d.start_col,n),d.end_col=l.max_w_missing(d.end_col,n)}}),d);l.set_element_in_grid(t.grid_element,_),t.on_drag&&t.on_drag({xy:n,grid:_})}}function d(e){var n,l=e;r.remove(),o=null,i=null,t.on_end&&t.on_end({xy:l,grid:(n=t.grid_element||this.parentElement,{start_row:+n.style.gridRowStart,start_col:+n.style.gridColumnStart,end_row:+n.style.gridRowEnd-1,end_col:+n.style.gridColumnEnd-1})}),a.removeEventListener(\"mousemove\",s),a.removeEventListener(\"mouseup\",d)}function u(e){return{left:e.left+\"px\",top:e.top+\"px\",width:e.right-e.left+\"px\",height:e.bottom-e.top+\"px\"}}t.watching_element.onmousedown=function(c){i=c,_.appendChild(t.grid_element),o=l.get_bounding_rect(t.grid_element)||{left:c.offsetX,right:c.offsetX,top:c.offsetY,bottom:c.offsetY},r=n.make_el(_.querySelector(\"#drag_canvas\"),\"div.drag-feedback-rect\",{styles:e({},u(o))}),t.on_start&&t.on_start(i),a.addEventListener(\"mousemove\",s),a.addEventListener(\"mouseup\",d)}}function w(){var e=[];return _.querySelectorAll(\".added-element\").forEach(function(t){if(\"current_selection_box\"!==t.id){var n=t.style.gridArea.split(\" / \");e.push({id:t.id,start_row:+n[0],start_col:+n[1],end_row:+n[2]-1,end_col:+n[3]-1})}}),e}function b(){if(exports.Shiny){var e={};w().forEach(function(t){e[t.id]=t}),exports.Shiny.setInputValue(\"elements\",e)}}function k(){return _.style.gridTemplateRows.split(\" \")}function x(){return _.style.gridTemplateColumns.split(\" \")}function T(){var e=[\"#e41a1c\",\"#377eb8\",\"#4daf4a\",\"#984ea3\",\"#ff7f00\",\"#ffff33\",\"#a65628\",\"#f781bf\"];return e[_.querySelectorAll(\".added-element\").length%e.length]}function S(e){l.as_array(e).forEach(function(e){n.remove_elements(document.querySelectorAll(\"div.el_\"+e+\".added-element\"))}),b()}exports.Shiny?(exports.Shiny.addCustomMessageHandler(\"update-grid\",function(e){v(e)}),exports.Shiny.addCustomMessageHandler(\"add-elements\",function(e){e.forEach(function(e){h({id:e.id,grid_pos:e})})}),exports.Shiny.addCustomMessageHandler(\"code_modal\",function(e){f(\"Paste the following code into your app to update the layout\",{type:\"R\",code:e})})):(v({rows:[\"1fr\",\"1fr\"],cols:[\"1fr\",\"1fr\"],gap:\"1rem\"}),document.getElementById(\"get_code\").addEventListener(\"click\",function(){var e,n,r,o;f(\"Place the following in your CSS:\",(e=w(),n=e.map(function(e){return l.concat_nl(\"#\"+e.id+\" {\",\"  grid-column: \"+l.make_template_start_end(e.start_col,e.end_col)+\";\",\"  grid-row: \"+l.make_template_start_end(e.start_row,e.end_row)+\";\",\"}\")}),r=l.concat_nl.apply(void 0,t([\"#container {\",\"  display: grid;\",\"  grid-template-columns: \"+_.style.gridTemplateColumns+\";\",\"  grid-template-rows: \"+_.style.gridTemplateRows+\";\",\"  grid-gap: \"+_.style.getPropertyValue(\"--grid-gap\"),\"}\"],n)),o=l.concat_nl.apply(void 0,t(t([\"<div id = #container>\"],e.map(function(e){return l.concat_nl('  <div id = \"#'+e.id+'\">',\"  </div>\")})),[\"</div>\"])),[{type:\"css\",code:r},{type:\"html\",code:o}]))}))},window.onresize=function(){r.draw_browser_header()};"},"sourceMaps":null,"error":null,"hash":"dec715be4aecd160eb5494f289a21ea3","cacheData":{"env":{}}}